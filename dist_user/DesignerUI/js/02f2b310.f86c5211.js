(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["02f2b310"],{"21a6":function(t,e,n){(function(n){var o,i,s;(function(n,a){i=[],o=a,s="function"===typeof o?o.apply(e,i):o,void 0===s||(t.exports=s)})(0,function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function o(t,e,n){var o=new XMLHttpRequest;o.open("GET",t),o.responseType="blob",o.onload=function(){r(o.response,e,n)},o.onerror=function(){console.error("could not download file")},o.send()}function i(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function s(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(o){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,r=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(t,e,n){var r=a.URL||a.webkitURL,l=document.createElement("a");e=e||t.name||"download",l.download=e,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?s(l):i(l.href)?o(t,e,n):s(l,l.target="_blank")):(l.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(l.href)},4e4),setTimeout(function(){s(l)},0))}:"msSaveOrOpenBlob"in navigator?function(t,n,a){if(n=n||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,a),n);else if(i(t))o(t,n,a);else{var r=document.createElement("a");r.href=t,r.target="_blank",setTimeout(function(){s(r)})}}:function(t,e,n,i){if(i=i||open("","_blank"),i&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return o(t,e,n);var s="application/octet-stream"===t.type,r=/constructor/i.test(a.HTMLElement)||a.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||s&&r)&&"object"==typeof FileReader){var u=new FileReader;u.onloadend=function(){var t=u.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=t:location=t,i=null},u.readAsDataURL(t)}else{var p=a.URL||a.webkitURL,h=p.createObjectURL(t);i?i.location=h:location.href=h,i=null,setTimeout(function(){p.revokeObjectURL(h)},4e4)}});a.saveAs=r.saveAs=r,t.exports=r})}).call(this,n("c8ba"))},"37c8":function(t,e,n){e.f=n("2b4c")},"3a72":function(t,e,n){var o=n("7726"),i=n("8378"),s=n("2d00"),a=n("37c8"),r=n("86cc").f;t.exports=function(t){var e=i.Symbol||(i.Symbol=s?{}:o.Symbol||{});"_"==t.charAt(0)||t in e||r(e,t,{value:a.f(t)})}},"67ab":function(t,e,n){var o=n("ca5a")("meta"),i=n("d3f4"),s=n("69a8"),a=n("86cc").f,r=0,l=Object.isExtensible||function(){return!0},u=!n("79e5")(function(){return l(Object.preventExtensions({}))}),p=function(t){a(t,o,{value:{i:"O"+ ++r,w:{}}})},h=function(t,e){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!s(t,o)){if(!l(t))return"F";if(!e)return"E";p(t)}return t[o].i},c=function(t,e){if(!s(t,o)){if(!l(t))return!0;if(!e)return!1;p(t)}return t[o].w},d=function(t){return u&&g.NEED&&l(t)&&!s(t,o)&&p(t),t},g=t.exports={KEY:o,NEED:!1,fastKey:h,getWeak:c,onFreeze:d}},"6e14":function(module,exports,__webpack_require__){(function(process){(function(t){var e=t.LiteGraph={CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:20,NODE_SLOT_HEIGHT:15,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:180,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#e6f4eb",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"rgba(35,35,35,0.99)",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#f4511e",NODE_DEFAULT_BGCOLOR:"rgba(255,236,201,0.52)",NODE_DEFAULT_BOXCOLOR:"rgba(255,236,201,0.52)",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,LINK_COLOR:"#AAD",EVENT_LINK_COLOR:"#F85",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},searchbox_extras:{},registerNodeType:function(t,n){if(!n.prototype)throw"Cannot register a simple object, it must be a class with a prototype";n.type=t,e.debug&&console.log("Node registered: "+t);t.split("/");var i=n.name,s=t.lastIndexOf("/");if(n.category=t.substr(0,s),n.title||(n.title=i),n.prototype)for(var a in o.prototype)n.prototype[a]||(n.prototype[a]=o.prototype[a]);if(Object.defineProperty(n.prototype,"shape",{set:function(t){switch(t){case"default":delete this._shape;break;case"box":this._shape=e.BOX_SHAPE;break;case"round":this._shape=e.ROUND_SHAPE;break;case"circle":this._shape=e.CIRCLE_SHAPE;break;case"card":this._shape=e.CARD_SHAPE;break;default:this._shape=t}},get:function(t){return this._shape},enumerable:!0}),this.registered_node_types[t]=n,n.constructor.name&&(this.Nodes[i]=n),n.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),n.supported_extensions)for(var a in n.supported_extensions)this.node_types_by_file_extension[n.supported_extensions[a].toLowerCase()]=n},wrapFunctionAsNode:function(t,n,o,i){for(var s=Array(n.length),a="",r=e.getParameterNames(n),l=0;l<r.length;++l)a+="this.addInput('"+r[l]+"',"+(o&&o[l]?"'"+o[l]+"'":"0")+");\n";a+="this.addOutput('out',"+(i?"'"+i+"'":0)+");\n";var u=Function(a);u.title=t.split("/").pop(),u.desc="Generated from "+n.name,u.prototype.onExecute=function(){for(var t=0;t<s.length;++t)s[t]=this.getInputData(t);var e=n.apply(this,s);this.setOutputData(0,e)},this.registerNodeType(t,u)},addNodeMethod:function(t,e){for(var n in o.prototype[t]=e,this.registered_node_types){var i=this.registered_node_types[n];i.prototype[t]&&(i.prototype["_"+t]=i.prototype[t]),i.prototype[t]=e}},createNode:function(t,n,o){var i=this.registered_node_types[t];if(!i)return e.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;i.prototype;n=n||i.title||t;var s=new i(n);if(s.type=t,!s.title&&n&&(s.title=n),s.properties||(s.properties={}),s.properties_info||(s.properties_info=[]),s.flags||(s.flags={}),s.size||(s.size=s.computeSize()),s.pos||(s.pos=e.DEFAULT_POSITION.concat()),s.mode||(s.mode=e.ALWAYS),o)for(var a in o)s[a]=o[a];return s},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var n=[];for(var o in this.registered_node_types){var i=this.registered_node_types[o];e&&i.filter&&i.filter!=e||(""==t?null==i.category&&n.push(i):i.category==t&&n.push(i))}return n},getNodeTypesCategories:function(){var t={"":1};for(var e in this.registered_node_types)this.registered_node_types[e].category&&!this.registered_node_types[e].skip_list&&(t[this.registered_node_types[e].category]=1);var n=[];for(var e in t)n.push(e);return n},reloadNodes:function(t){var n=document.getElementsByTagName("script"),o=[];for(var i in n)o.push(n[i]);var s=document.getElementsByTagName("head")[0];for(var i in t=document.location.href+t,o){var a=o[i].src;if(a&&a.substr(0,t.length)==t)try{e.debug&&console.log("Reloading: "+a);var r=document.createElement("script");r.type="text/javascript",r.src=a,s.appendChild(r),s.removeChild(o[i])}catch(l){if(e.throw_errors)throw l;e.debug&&console.log("Error while reloading "+a)}}e.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(null==t)return null;var n=JSON.parse(JSON.stringify(t));if(!e)return n;for(var o in n)e[o]=n[o];return e},isValidConnection:function(t,n){if(!t||!n||t==n||t==e.EVENT&&n==e.ACTION)return!0;if(t=String(t),n=String(n),t=t.toLowerCase(),n=n.toLowerCase(),-1==t.indexOf(",")&&-1==n.indexOf(","))return t==n;for(var o=t.split(","),i=n.split(","),s=0;s<o.length;++s)for(var a=0;a<i.length;++a)if(o[s]==i[a])return!0;return!1},registerSearchboxExtra:function(t,e,n){this.searchbox_extras[e]={type:t,desc:e,data:n}}};function n(t){e.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}function o(t){this._ctor(t)}function i(t){this._ctor(t)}function s(t,n,o){o=o||{},this.background_image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",t&&t.constructor===String&&(t=document.querySelector(t)),this.max_zoom=10,this.min_zoom=.1,this.zoom_modify_alpha=!0,this.title_text_font="bold "+e.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+e.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=e.NODE_TITLE_COLOR,this.default_link_color=e.LINK_COLOR,this.default_connection_color={input_off:"#AAB",input_on:"#7F7",output_off:"#AAB",output_on:"#7F7"},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.render_shadows=!0,this.clear_background=!0,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.allow_searchbox=!0,this.allow_reconnect_links=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.always_render_background=!1,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!0,this.render_execution_order=!1,this.canvas_mouse=[0,0],this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.last_mouse_position=[0,0],this.visible_area=new Float32Array(4),n&&n.attachCanvas(this),this.setCanvas(t),this.clear(),o.skip_render||this.startRendering(),this.autoresize=o.autoresize}"undefined"!=typeof performance?e.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?e.getTime=Date.now.bind(Date):e.getTime="undefined"!=typeof process?function(){var t=process.hrtime();return.001*t[0]+1e-6*t[1]}:function(){return(new Date).getTime()},t.LGraph=e.LGraph=n,n.supported_types=["number","string","boolean"],n.prototype.getSupportedTypes=function(){return this.supported_types||n.supported_types},n.STATUS_STOPPED=1,n.STATUS_RUNNING=2,n.prototype.clear=function(){if(this.stop(),this.status=n.STATUS_STOPPED,this.last_node_id=1,this.last_link_id=1,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.global_inputs={},this.global_outputs={},this.change(),this.sendActionToCanvas("clear")},n.prototype.attachCanvas=function(t){if(t.constructor!=s)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},n.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);-1!=e&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},n.prototype.start=function(t){if(this.status!=n.STATUS_RUNNING){this.status=n.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=e.getTime(),this.last_update_time=this.starttime,t=t||0;var o=this;if(0==t&&"undefined"!=typeof window&&window.requestAnimationFrame){function i(){-1==o.execution_timer_id&&(window.requestAnimationFrame(i),o.runStep(1,!this.catch_errors))}this.execution_timer_id=-1,i()}else o.runStep(1,!this.catch_errors)}},n.prototype.stop=function(){this.status!=n.STATUS_STOPPED&&(this.status=n.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},n.prototype.runStep=function(t,n){t=t||1;var o=e.getTime();this.globaltime=.001*(o-this.starttime);var i=this._nodes_executable?this._nodes_executable:this._nodes;if(i){if(n){for(var s=0;s<t;s++){for(var a=0,r=i.length;a<r;++a){var l=i[a];l.mode==e.ALWAYS&&l.onExecute&&l.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(s=0;s<t;s++){for(a=0,r=i.length;a<r;++a){l=i[a];l.mode==e.ALWAYS&&l.onExecute&&l.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(h){if(this.errors_in_execution=!0,e.throw_errors)throw h;e.debug&&console.log("Error during execution: "+h),this.stop()}var u=e.getTime(),p=u-o;0==p&&(p=1),this.execution_time=.001*p,this.globaltime+=.001*p,this.iteration+=1,this.elapsed_time=.001*(u-this.last_update_time),this.last_update_time=u}},n.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},n.prototype.computeExecutionOrder=function(t,n){for(var o=[],i=[],s={},a={},r={},l=0,u=this._nodes.length;l<u;++l){var p=this._nodes[l];if(!t||p.onExecute){s[p.id]=p;var h=0;if(p.inputs)for(var c=0,d=p.inputs.length;c<d;c++)p.inputs[c]&&null!=p.inputs[c].link&&(h+=1);0==h?(i.push(p),n&&(p._level=1)):(n&&(p._level=0),r[p.id]=h)}}while(1){if(0==i.length)break;p=i.shift();if(o.push(p),delete s[p.id],p.outputs)for(l=0;l<p.outputs.length;l++){var g=p.outputs[l];if(null!=g&&null!=g.links&&0!=g.links.length)for(c=0;c<g.links.length;c++){var f=g.links[c],_=this.links[f];if(_&&!a[_.id]){var v=this.getNodeById(_.target_id);null!=v?(n&&(!v._level||v._level<=p._level)&&(v._level=p._level+1),a[_.id]=!0,r[v.id]-=1,0==r[v.id]&&i.push(v)):a[_.id]=!0}}}}for(var l in s)o.push(s[l]);o.length!=this._nodes.length&&e.debug&&console.warn("something went wrong, nodes missing");for(u=o.length,l=0;l<u;++l)o[l].order=l;o=o.sort(function(t,e){var n=t.constructor.priority||t.priority||0,o=e.constructor.priority||e.priority||0;return n==o?t.order-e.order:n-o});for(l=0;l<u;++l)o[l].order=l;return o},n.prototype.getAncestors=function(t){var e=[],n=[t],o={};while(n.length){var i=n.shift();if(i.inputs){o[i.id]||i==t||(o[i.id]=!0,e.push(i));for(var s=0;s<i.inputs.length;++s){var a=i.getInputNode(s);a&&-1==e.indexOf(a)&&n.push(a)}}}return e.sort(function(t,e){return t.order-e.order}),e},n.prototype.arrange=function(t){t=t||40;for(var e=this.computeExecutionOrder(!1,!0),n=[],o=0;o<e.length;++o){var i=e[o],s=i._level||1;n[s]||(n[s]=[]),n[s].push(i)}var a=t;for(o=0;o<n.length;++o){var r=n[o];if(r){for(var l=100,u=t,p=0;p<r.length;++p){i=r[p];i.pos[0]=a,i.pos[1]=u,i.size[0]>l&&(l=i.size[0]),u+=i.size[1]+t}a+=l+t}}this.setDirtyCanvas(!0,!0)},n.prototype.getTime=function(){return this.globaltime},n.prototype.getFixedTime=function(){return this.fixedtime},n.prototype.getElapsedTime=function(){return this.elapsed_time},n.prototype.sendEventToAllNodes=function(t,n,o){o=o||e.ALWAYS;var i=this._nodes_in_order?this._nodes_in_order:this._nodes;if(i)for(var s=0,a=i.length;s<a;++s){var r=i[s];r[t]&&r.mode==o&&(void 0===n?r[t]():n&&n.constructor===Array?r[t].apply(r,n):r[t](n))}},n.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var n=0;n<this.list_of_graphcanvas.length;++n){var o=this.list_of_graphcanvas[n];o[t]&&o[t].apply(o,e)}},n.prototype.add=function(t,n){if(t){if(t.constructor===i)return this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,void this._version++;if(-1!=t.id&&null!=this._nodes_by_id[t.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),t.id=++this.last_node_id),this._nodes.length>=e.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return null==t.id||-1==t.id?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),n||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},n.prototype.remove=function(t){if(t.constructor===e.LGraphGroup){var n=this._groups.indexOf(t);return-1!=n&&this._groups.splice(n,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),void this.change()}if(null!=this._nodes_by_id[t.id]&&!t.ignore_remove){if(t.inputs)for(var o=0;o<t.inputs.length;o++){var i=t.inputs[o];null!=i.link&&t.disconnectInput(o)}if(t.outputs)for(o=0;o<t.outputs.length;o++){i=t.outputs[o];null!=i.links&&i.links.length&&t.disconnectOutput(o)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(o=0;o<this.list_of_graphcanvas.length;++o){var s=this.list_of_graphcanvas[o];s.selected_nodes[t.id]&&delete s.selected_nodes[t.id],s.node_dragged==t&&(s.node_dragged=null)}var a=this._nodes.indexOf(t);-1!=a&&this._nodes.splice(a,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},n.prototype.getNodeById=function(t){return null==t?null:this._nodes_by_id[t]},n.prototype.findNodesByClass=function(t){for(var e=[],n=0,o=this._nodes.length;n<o;++n)this._nodes[n].constructor===t&&e.push(this._nodes[n]);return e},n.prototype.findNodesByType=function(t){t=t.toLowerCase();for(var e=[],n=0,o=this._nodes.length;n<o;++n)this._nodes[n].type.toLowerCase()==t&&e.push(this._nodes[n]);return e},n.prototype.findNodesByTitle=function(t){for(var e=[],n=0,o=this._nodes.length;n<o;++n)this._nodes[n].title==t&&e.push(this._nodes[n]);return e},n.prototype.getNodeOnPos=function(t,e,n,o){n=n||this._nodes;for(var i=n.length-1;i>=0;i--){var s=n[i];if(s.isPointInside(t,e,o))return s}return null},n.prototype.getGroupOnPos=function(t,e){for(var n=this._groups.length-1;n>=0;n--){var o=this._groups[n];if(o.isPointInside(t,e,2,!0))return o}return null},n.prototype.addGlobalInput=function(t,e,n){this.global_inputs[t]={name:t,type:e,value:n},this._version++,this.onGlobalInputAdded&&this.onGlobalInputAdded(t,e),this.onGlobalsChange&&this.onGlobalsChange()},n.prototype.setGlobalInputData=function(t,e){var n=this.global_inputs[t];n&&(n.value=e)},n.prototype.setInputData=n.prototype.setGlobalInputData,n.prototype.getGlobalInputData=function(t){var e=this.global_inputs[t];return e?e.value:null},n.prototype.renameGlobalInput=function(t,e){if(e!=t){if(!this.global_inputs[t])return!1;if(this.global_inputs[e])return console.error("there is already one input with that name"),!1;this.global_inputs[e]=this.global_inputs[t],delete this.global_inputs[t],this._version++,this.onGlobalInputRenamed&&this.onGlobalInputRenamed(t,e),this.onGlobalsChange&&this.onGlobalsChange()}},n.prototype.changeGlobalInputType=function(t,e){if(!this.global_inputs[t])return!1;this.global_inputs[t].type&&this.global_inputs[t].type.toLowerCase()==e.toLowerCase()||(this.global_inputs[t].type=e,this._version++,this.onGlobalInputTypeChanged&&this.onGlobalInputTypeChanged(t,e))},n.prototype.removeGlobalInput=function(t){return!!this.global_inputs[t]&&(delete this.global_inputs[t],this._version++,this.onGlobalInputRemoved&&this.onGlobalInputRemoved(t),this.onGlobalsChange&&this.onGlobalsChange(),!0)},n.prototype.addGlobalOutput=function(t,e,n){this.global_outputs[t]={name:t,type:e,value:n},this._version++,this.onGlobalOutputAdded&&this.onGlobalOutputAdded(t,e),this.onGlobalsChange&&this.onGlobalsChange()},n.prototype.setGlobalOutputData=function(t,e){var n=this.global_outputs[t];n&&(n.value=e)},n.prototype.getGlobalOutputData=function(t){var e=this.global_outputs[t];return e?e.value:null},n.prototype.getOutputData=n.prototype.getGlobalOutputData,n.prototype.renameGlobalOutput=function(t,e){return!!this.global_outputs[t]&&(this.global_outputs[e]?(console.error("there is already one output with that name"),!1):(this.global_outputs[e]=this.global_outputs[t],delete this.global_outputs[t],this._version++,this.onGlobalOutputRenamed&&this.onGlobalOutputRenamed(t,e),void(this.onGlobalsChange&&this.onGlobalsChange())))},n.prototype.changeGlobalOutputType=function(t,e){if(!this.global_outputs[t])return!1;this.global_outputs[t].type&&this.global_outputs[t].type.toLowerCase()==e.toLowerCase()||(this.global_outputs[t].type=e,this._version++,this.onGlobalOutputTypeChanged&&this.onGlobalOutputTypeChanged(t,e))},n.prototype.removeGlobalOutput=function(t){return!!this.global_outputs[t]&&(delete this.global_outputs[t],this._version++,this.onGlobalOutputRemoved&&this.onGlobalOutputRemoved(t),this.onGlobalsChange&&this.onGlobalsChange(),!0)},n.prototype.triggerInput=function(t,e){for(var n=this.findNodesByTitle(t),o=0;o<n.length;++o)n[o].onTrigger(e)},n.prototype.setCallback=function(t,e){for(var n=this.findNodesByTitle(t),o=0;o<n.length;++o)n[o].setTrigger(e)},n.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},n.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var e=this.list_of_graphcanvas[t];if(e.live_mode)return!0}return!1},n.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&(e._last_time&&(e._last_time=0))}},n.prototype.change=function(){e.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},n.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},n.prototype.serialize=function(){for(var t=[],e=0,n=this._nodes.length;e<n;++e)t.push(this._nodes[e].serialize());var o=[];for(var e in this.links){var i=this.links[e];o.push([i.id,i.origin_id,i.origin_slot,i.target_id,i.target_slot,i.type])}var s=[];for(e=0;e<this._groups.length;++e)s.push(this._groups[e].serialize());var a={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:o,groups:s,config:this.config};return a},n.prototype.configure=function(t,n){if(t){n||this.clear();var o=t.nodes;if(t.links&&t.links.constructor===Array){for(var i=[],s=0;s<t.links.length;++s){var a=t.links[s];i[a[0]]={id:a[0],origin_id:a[1],origin_slot:a[2],target_id:a[3],target_slot:a[4],type:a[5]}}t.links=i}for(var s in t)this[s]=t[s];var r=!1;if(this._nodes=[],o){s=0;for(var l=o.length;s<l;++s){var u=o[s],p=e.createNode(u.type,u.title);p?(p.id=u.id,this.add(p,!0)):(e.debug&&console.log("Node not found: "+u.type),r=!0)}for(s=0,l=o.length;s<l;++s){u=o[s],p=this.getNodeById(u.id);p&&p.configure(u)}}if(this._groups.length=0,t.groups)for(s=0;s<t.groups.length;++s){var h=new e.LGraphGroup;h.configure(t.groups[s]),this.add(h)}return this.updateExecutionOrder(),this._version++,this.setDirtyCanvas(!0,!0),r}},n.prototype.load=function(t){var e=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.send(null),n.onload=function(t){if(200===n.status){var o=JSON.parse(n.response);e.configure(o)}else console.error("Error loading graph:",n.status,n.response)},n.onerror=function(t){console.error("Error loading graph:",t)}},n.prototype.onNodeTrace=function(t,e,n){},t.LGraphNode=e.LGraphNode=o,o.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[e.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},o.prototype.configure=function(t){for(var n in this.graph&&this.graph._version++,t)if("console"!=n)if("properties"!=n)null!=t[n]&&("object"==typeof t[n]?this[n]&&this[n].configure?this[n].configure(t[n]):this[n]=e.cloneObject(t[n],this[n]):this[n]=t[n]);else for(var o in t.properties)this.properties[o]=t.properties[o],this.onPropertyChanged&&this.onPropertyChanged(o,t.properties[o]);if(t.title||(this.title=this.constructor.title),this.onConnectionsChange){if(this.inputs)for(var i=0;i<this.inputs.length;++i){var s=this.inputs[i],a=this.graph?this.graph.links[s.link]:null;this.onConnectionsChange(e.INPUT,i,!0,a,s)}if(this.outputs)for(i=0;i<this.outputs.length;++i){var r=this.outputs[i];if(r.links)for(n=0;n<r.links.length;++n){a=this.graph?this.graph.links[r.links[n]]:null;this.onConnectionsChange(e.OUTPUT,i,!0,a,r)}}}for(var i in this.inputs){s=this.inputs[i];if(s.link&&s.link.length){var l=s.link;"object"==typeof l&&(s.link=l[0],this.graph&&(this.graph.links[l[0]]={id:l[0],origin_id:l[1],origin_slot:l[2],target_id:l[3],target_slot:l[4]}))}}for(var i in this.outputs){r=this.outputs[i];if(r.links&&0!=r.links.length)for(var n in r.links){l=r.links[n];"object"==typeof l&&(r.links[n]=l[0])}}this.onConfigure&&this.onConfigure(t)},o.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:e.cloneObject(this.flags),mode:this.mode};if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var n=0;n<this.outputs.length;n++)delete this.outputs[n]._data;t.outputs=this.outputs}return this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=e.cloneObject(this.properties)),t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},o.prototype.clone=function(){var t=e.createNode(this.type),n=e.cloneObject(this.serialize());if(n.inputs)for(var o=0;o<n.inputs.length;++o)n.inputs[o].link=null;if(n.outputs)for(o=0;o<n.outputs.length;++o)n.outputs[o].links&&(n.outputs[o].links.length=0);return delete n["id"],t.configure(n),t},o.prototype.toString=function(){return JSON.stringify(this.serialize())},o.prototype.getTitle=function(){return this.title||this.constructor.title},o.prototype.setOutputData=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var n=this.outputs[t];if(n&&(n._data=e,this.outputs[t].links))for(var o=0;o<this.outputs[t].links.length;o++){var i=this.outputs[t].links[o];this.graph.links[i].data=e}}},o.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||null==this.inputs[t].link)){var n=this.inputs[t].link,o=this.graph.links[n];if(!o)return null;if(!e)return o.data;var i=this.graph.getNodeById(o.origin_id);return i?(i.updateOutputData?i.updateOutputData(o.origin_slot):i.onExecute&&i.onExecute(),o.data):o.data}},o.prototype.getInputDataByName=function(t,e){var n=this.findInputSlot(t);return-1==n?null:this.getInputData(n,e)},o.prototype.isInputConnected=function(t){return!!this.inputs&&(t<this.inputs.length&&null!=this.inputs[t].link)},o.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},o.prototype.getInputNode=function(t){if(!this.inputs)return null;if(t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||null===e.link)return null;var n=this.graph.links[e.link];return n?this.graph.getNodeById(n.origin_id):null},o.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,n=this.inputs.length;e<n;++e)if(t==this.inputs[e].name){var o=this.inputs[e].link,i=this.graph.links[o];return i?i.data:null}return this.properties[t]},o.prototype.getOutputData=function(t){if(!this.outputs)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];return e._data},o.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},o.prototype.isOutputConnected=function(t){return!!this.outputs&&(t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length)},o.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},o.prototype.getOutputNodes=function(t){if(!this.outputs||0==this.outputs.length)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||0==e.links.length)return null;for(var n=[],o=0;o<e.links.length;o++){var i=e.links[o],s=this.graph.links[i];if(s){var a=this.graph.getNodeById(s.target_id);a&&n.push(a)}}return n},o.prototype.trigger=function(t,n){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=e.getTime());for(var o=0;o<this.outputs.length;++o){var i=this.outputs[o];!i||i.type!==e.EVENT||t&&i.name!=t||this.triggerSlot(o,n)}}},o.prototype.triggerSlot=function(t,n,o){if(this.outputs){var i=this.outputs[t];if(i){var s=i.links;if(s&&s.length){this.graph&&(this.graph._last_trigger_time=e.getTime());for(var a=0;a<s.length;++a){var r=s[a];if(null==o||o==r){var l=this.graph.links[s[a]];if(l){l._last_time=e.getTime();var u=this.graph.getNodeById(l.target_id);if(u){var p=u.inputs[l.target_slot];u.onAction?u.onAction(p.name,n):u.mode===e.ON_TRIGGER&&u.onExecute&&u.onExecute(n)}}}}}}}},o.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var n=this.outputs[t];if(n){var o=n.links;if(o&&o.length)for(var i=0;i<o.length;++i){var s=o[i];if(null==e||e==s){var a=this.graph.links[o[i]];a&&(a._last_time=0)}}}}},o.prototype.addProperty=function(t,e,n,o){var i={name:t,type:n,default_value:e};if(o)for(var s in o)i[s]=o[s];return this.properties_info||(this.properties_info=[]),this.properties_info.push(i),this.properties||(this.properties={}),this.properties[t]=e,i},o.prototype.addOutput=function(t,e,n){var o={name:t,type:e,links:null};if(n)for(var i in n)o[i]=n[i];return this.outputs||(this.outputs=[]),this.outputs.push(o),this.onOutputAdded&&this.onOutputAdded(o),this.size=this.computeSize(),this.setDirtyCanvas(!0,!0),o},o.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],o={name:n[0],type:n[1],link:null};if(t[2])for(var i in n[2])o[i]=n[2][i];this.outputs||(this.outputs=[]),this.outputs.push(o),this.onOutputAdded&&this.onOutputAdded(o)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},o.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(this.outputs[e]&&this.outputs[e].links)for(var n=this.outputs[e].links,o=0;o<n.length;++o){var i=this.graph.links[n[o]];i&&(i.origin_slot-=1)}this.size=this.computeSize(),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},o.prototype.addInput=function(t,e,n){e=e||0;var o={name:t,type:e,link:null};if(n)for(var i in n)o[i]=n[i];return this.inputs||(this.inputs=[]),this.inputs.push(o),this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(o),this.setDirtyCanvas(!0,!0),o},o.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],o={name:n[0],type:n[1],link:null};if(t[2])for(var i in n[2])o[i]=n[2][i];this.inputs||(this.inputs=[]),this.inputs.push(o),this.onInputAdded&&this.onInputAdded(o)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},o.prototype.removeInput=function(t){this.disconnectInput(t),this.inputs.splice(t,1);for(var e=t;e<this.inputs.length;++e)if(this.inputs[e]){var n=this.graph.links[this.inputs[e].link];n&&(n.target_slot-=1)}this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(t),this.setDirtyCanvas(!0,!0)},o.prototype.addConnection=function(t,e,n,o){var i={name:t,type:e,pos:n,direction:o,links:null};return this.connections.push(i),i},o.prototype.computeSize=function(t,n){var o=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),i=n||new Float32Array([0,0]);o=Math.max(o,1);var s=e.NODE_TEXT_SIZE;i[1]=(this.constructor.slot_start_y||0)+o*(s+1)+4,this.widgets&&this.widgets.length&&(i[1]+=this.widgets.length*(e.NODE_WIDGET_HEIGHT+4)+8);s=s;var a=f(this.title),r=0,l=0;if(this.inputs)for(var u=0,p=this.inputs.length;u<p;++u){var h=this.inputs[u],c=h.label||h.name||"",d=f(c);r<d&&(r=d)}if(this.outputs)for(u=0,p=this.outputs.length;u<p;++u){var g=this.outputs[u];c=g.label||g.name||"",d=f(c);l<d&&(l=d)}function f(t){return t?s*t.length*.6:0}return i[0]=Math.max(r+l+10,a),i[0]=Math.max(i[0],e.NODE_WIDTH),this.widgets&&this.widgets.length&&(i[0]=Math.max(i[0],1.5*e.NODE_WIDTH)),this.onResize&&this.onResize(i),i},o.prototype.addWidget=function(t,e,n,o,i){this.widgets||(this.widgets=[]);var s={type:t.toLowerCase(),name:e,value:n,callback:o,options:i||{}};if(void 0!==s.options.y&&(s.y=s.options.y),o||console.warn("LiteGraph addWidget('button',...) without a callback"),"combo"==t&&!s.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(s),s},o.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},o.prototype.getBounding=function(t){return t=t||new Float32Array(4),t[0]=this.pos[0]-4,t[1]=this.pos[1]-e.NODE_TITLE_HEIGHT,t[2]=this.size[0]+4,t[3]=this.size[1]+e.NODE_TITLE_HEIGHT,this.onBounding&&this.onBounding(t),t},o.prototype.isPointInside=function(t,n,o,i){o=o||0;var s=this.graph&&this.graph.isLive()?0:20;if(i&&(s=0),this.flags&&this.flags.collapsed){if(c(t,n,this.pos[0]-o,this.pos[1]-e.NODE_TITLE_HEIGHT-o,(this._collapsed_width||e.NODE_COLLAPSED_WIDTH)+2*o,e.NODE_TITLE_HEIGHT+2*o))return!0}else if(this.pos[0]-4-o<t&&this.pos[0]+this.size[0]+4+o>t&&this.pos[1]-s-o<n&&this.pos[1]+this.size[1]+o>n)return!0;return!1},o.prototype.getSlotInPosition=function(t,e){var n=new Float32Array(2);if(this.inputs)for(var o=0,i=this.inputs.length;o<i;++o){var s=this.inputs[o];if(this.getConnectionPos(!0,o,n),c(t,e,n[0]-10,n[1]-5,20,10))return{input:s,slot:o,link_pos:n,locked:s.locked}}if(this.outputs)for(o=0,i=this.outputs.length;o<i;++o){var a=this.outputs[o];if(this.getConnectionPos(!1,o,n),c(t,e,n[0]-10,n[1]-5,20,10))return{output:a,slot:o,link_pos:n,locked:a.locked}}return null},o.prototype.findInputSlot=function(t){if(!this.inputs)return-1;for(var e=0,n=this.inputs.length;e<n;++e)if(t==this.inputs[e].name)return e;return-1},o.prototype.findOutputSlot=function(t){if(!this.outputs)return-1;for(var e=0,n=this.outputs.length;e<n;++e)if(t==this.outputs[e].name)return e;return-1},o.prototype.connect=function(t,n,o){if(o=o||0,!this.graph)return console.log("Connect: Error, node doesnt belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),null;if(n&&n.constructor===Number&&(n=this.graph.getNodeById(n)),!n)throw"target node is null";if(n==this)return null;if(o.constructor===String){if(o=n.findInputSlot(o),-1==o)return e.debug&&console.log("Connect: Error, no slot of name "+o),null}else{if(o===e.EVENT)return null;if(!n.inputs||o>=n.inputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),null}null!=n.inputs[o].link&&n.disconnectInput(o);var i=this.outputs[t];if(n.onConnectInput&&!1===n.onConnectInput(o,i.type,i))return null;var s=n.inputs[o],a=null;return e.isValidConnection(i.type,s.type)&&(a={id:this.graph.last_link_id++,type:s.type,origin_id:this.id,origin_slot:t,target_id:n.id,target_slot:o},this.graph.links[a.id]=a,null==i.links&&(i.links=[]),i.links.push(a.id),n.inputs[o].link=a.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!0,a,i),n.onConnectionsChange&&n.onConnectionsChange(e.INPUT,o,!0,a,s),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.INPUT,n,o,this,t),this.graph.onNodeConnectionChange(e.OUTPUT,this,t,n,o))),this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this,a),a},o.prototype.disconnectOutput=function(t,n){if(t.constructor===String){if(t=this.findOutputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),!1;var o=this.outputs[t];if(!o||!o.links||0==o.links.length)return!1;if(n){if(n.constructor===Number&&(n=this.graph.getNodeById(n)),!n)throw"Target Node not found";for(var i=0,s=o.links.length;i<s;i++){var a=o.links[i],r=this.graph.links[a];if(r.target_id==n.id){o.links.splice(i,1);var l=n.inputs[r.target_slot];l.link=null,delete this.graph.links[a],this.graph&&this.graph._version++,n.onConnectionsChange&&n.onConnectionsChange(e.INPUT,r.target_slot,!1,r,l),this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!1,r,o),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph.onNodeConnectionChange(e.INPUT,n,r.target_slot));break}}}else{for(i=0,s=o.links.length;i<s;i++){a=o.links[i],r=this.graph.links[a];if(r){n=this.graph.getNodeById(r.target_id),l=null;this.graph&&this.graph._version++,n&&(l=n.inputs[r.target_slot],l.link=null,n.onConnectionsChange&&n.onConnectionsChange(e.INPUT,r.target_slot,!1,r,l),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(e.INPUT,n,r.target_slot)),delete this.graph.links[a],this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!1,r,o),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph.onNodeConnectionChange(e.INPUT,n,r.target_slot))}}o.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},o.prototype.disconnectInput=function(t){if(t.constructor===String){if(t=this.findInputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),!1;var n=this.inputs[t];if(!n)return!1;var o=this.inputs[t].link;this.inputs[t].link=null;var i=this.graph.links[o];if(i){var s=this.graph.getNodeById(i.origin_id);if(!s)return!1;var a=s.outputs[i.origin_slot];if(!a||!a.links||0==a.links.length)return!1;for(var r=0,l=a.links.length;r<l;r++)if(a.links[r]==o){a.links.splice(r,1);break}delete this.graph.links[o],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(e.INPUT,t,!1,i,n),s.onConnectionsChange&&s.onConnectionsChange(e.OUTPUT,r,!1,i,a),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,s,r),this.graph.onNodeConnectionChange(e.INPUT,this,t))}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},o.prototype.getConnectionPos=function(t,n,o){o=o||new Float32Array(2);var i=0;if(t&&this.inputs&&(i=this.inputs.length),!t&&this.outputs&&(i=this.outputs.length),this.flags.collapsed){var s=this._collapsed_width||e.NODE_COLLAPSED_WIDTH;return this.flags.horizontal?(o[0]=this.pos[0]+.5*s,o[1]=t?this.pos[1]-e.NODE_TITLE_HEIGHT:this.pos[1]):(o[0]=t?this.pos[0]:this.pos[0]+s,o[1]=this.pos[1]-.5*e.NODE_TITLE_HEIGHT),o}return t&&-1==n?(o[0]=this.pos[0]+10,o[1]=this.pos[1]+10,o):t&&i>n&&this.inputs[n].pos?(o[0]=this.pos[0]+this.inputs[n].pos[0],o[1]=this.pos[1]+this.inputs[n].pos[1],o):!t&&i>n&&this.outputs[n].pos?(o[0]=this.pos[0]+this.outputs[n].pos[0],o[1]=this.pos[1]+this.outputs[n].pos[1],o):this.flags.horizontal?(o[0]=this.pos[0]+(n+.5)*(this.size[0]/i),o[1]=t?this.pos[1]-e.NODE_TITLE_HEIGHT:this.pos[1]+this.size[1],o):(o[0]=t?this.pos[0]:this.pos[0]+this.size[0]+1,o[1]=this.pos[1]+10+n*e.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),o)},o.prototype.alignToGrid=function(){this.pos[0]=e.CANVAS_GRID_SIZE*Math.round(this.pos[0]/e.CANVAS_GRID_SIZE),this.pos[1]=e.CANVAS_GRID_SIZE*Math.round(this.pos[1]/e.CANVAS_GRID_SIZE)},o.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>o.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace(this,t)},o.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},o.prototype.loadImage=function(t){var n=new Image;n.src=e.node_images_path+t,n.ready=!1;var o=this;return n.onload=function(){this.ready=!0,o.setDirtyCanvas(!0)},n},o.prototype.captureInput=function(t){if(this.graph&&this.graph.list_of_graphcanvas)for(var e=this.graph.list_of_graphcanvas,n=0;n<e.length;++n){var o=e[n];(t||o.node_capturing_input==this)&&(o.node_capturing_input=t?this:null)}},o.prototype.collapse=function(t){this.graph._version++,(!1!==this.constructor.collapsable||t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},o.prototype.pin=function(t){this.graph._version++,this.flags.pinned=void 0===t?!this.flags.pinned:t},o.prototype.localToScreen=function(t,e,n){return[(t+this.pos[0])*n.scale+n.offset[0],(e+this.pos[1])*n.scale+n.offset[1]]},t.LGraphGroup=e.LGraphGroup=i,i.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=s.node_colors.pale_blue?s.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))},get:function(){return this._size},enumerable:!0})},i.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font=t.font},i.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font:this.font}},i.prototype.move=function(t,e,n){if(this._pos[0]+=t,this._pos[1]+=e,!n)for(var o=0;o<this._nodes.length;++o){var i=this._nodes[o];i.pos[0]+=t,i.pos[1]+=e}},i.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),n=0;n<t.length;++n){var o=t[n];o.getBounding(e),f(this._bounding,e)&&this._nodes.push(o)}},i.prototype.isPointInside=o.prototype.isPointInside,i.prototype.setDirtyCanvas=o.prototype.setDirtyCanvas,t.LGraphCanvas=e.LGraphCanvas=s,s.link_type_colors={"-1":"#F85",number:"#AAA",node:"#DCA"},s.gradients={},s.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.scale=1,this.offset=[0,0],this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},s.prototype.setGraph=function(t,e){this.graph!=t&&(e||this.clear(),t||!this.graph?(t.attachCanvas(this),this.setDirty(!0,!0)):this.graph.detachCanvas(this))},s.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.setDirty(!0,!0)},s.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t]))}},s.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&(t=document.getElementById(t),!t))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,t)){if(t.className+=" lgraphcanvas",t.data=this,this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),null==t.getContext){if("canvas"!=t.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName;throw"This browser doesnt support Canvas"}var n=this.ctx=t.getContext("2d");null==n&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),e||this.bindEvents()}},s.prototype._doNothing=function(t){return t.preventDefault(),!1},s.prototype._doReturnTrue=function(t){return t.preventDefault(),!0},s.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var t=this.canvas,e=this.getCanvasWindow(),n=e.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),t.addEventListener("mousedown",this._mousedown_callback,!0),t.addEventListener("mousemove",this._mousemove_callback),t.addEventListener("mousewheel",this._mousewheel_callback,!1),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),t.addEventListener("touchstart",this.touchHandler,!0),t.addEventListener("touchmove",this.touchHandler,!0),t.addEventListener("touchend",this.touchHandler,!0),t.addEventListener("touchcancel",this.touchHandler,!0),this._key_callback=this.processKey.bind(this),t.addEventListener("keydown",this._key_callback,!0),n.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}},s.prototype.unbindEvents=function(){if(this._events_binded){var t=this.getCanvasWindow(),e=t.document;this.canvas.removeEventListener("mousedown",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),e.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this.canvas.removeEventListener("touchstart",this.touchHandler),this.canvas.removeEventListener("touchmove",this.touchHandler),this.canvas.removeEventListener("touchend",this.touchHandler),this.canvas.removeEventListener("touchcancel",this.touchHandler),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")},s.getFileExtension=function(t){var e=t.indexOf("?");-1!=e&&(t=t.substr(0,e));var n=t.lastIndexOf(".");return-1==n?"":t.substr(n+1).toLowerCase()},s.prototype.enableWebGL=function(){if(void 0===typeof GL)throw"litegl.js must be included to use a WebGL canvas";if(void 0===typeof enableWebGLCanvas)throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},s.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},s.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},s.prototype.startRendering=function(){function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}this.is_rendering||(this.is_rendering=!0,t.call(this))},s.prototype.stopRendering=function(){this.is_rendering=!1},s.prototype.processMouseDown=function(t){if(this.graph){this.adjustMouseEvent(t);var n=this.getCanvasWindow();n.document;s.active_canvas=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback),n.document.addEventListener("mousemove",this._mousemove_callback,!0),n.document.addEventListener("mouseup",this._mouseup_callback,!0);var o=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),i=!1,a=e.getTime(),r=a-this.last_mouseclick<300;if(this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,e.closeAllContextMenus(n),!this.onMouse||1!=this.onMouse(t)){if(1==t.which){t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,i=!0);var l=!1;if(o&&this.allow_interaction&&!i){if(this.live_mode||o.flags.pinned||this.bringToFront(o),!this.connecting_node&&!o.flags.collapsed&&!this.live_mode)if(!i&&!1!==o.flags.resizable&&c(t.canvasX,t.canvasY,o.pos[0]+o.size[0]-5,o.pos[1]+o.size[1]-5,10,10))this.resizing_node=o,this.canvas.style.cursor="se-resize",i=!0;else{if(o.outputs)for(var u=0,h=o.outputs.length;u<h;++u){var d=o.outputs[u],g=o.getConnectionPos(!1,u);if(c(t.canvasX,t.canvasY,g[0]-15,g[1]-10,30,20)){this.connecting_node=o,this.connecting_output=d,this.connecting_pos=o.getConnectionPos(!1,u),this.connecting_slot=u,t.shiftKey&&o.disconnectOutput(u),r?o.onOutputDblClick&&o.onOutputDblClick(u,t):o.onOutputClick&&o.onOutputClick(u,t),i=!0;break}}if(o.inputs)for(u=0,h=o.inputs.length;u<h;++u){var f=o.inputs[u];g=o.getConnectionPos(!0,u);if(c(t.canvasX,t.canvasY,g[0]-15,g[1]-10,30,20)&&(r?o.onInputDblClick&&o.onInputDblClick(u,t):o.onInputClick&&o.onInputClick(u,t),null!==f.link)){var _=this.graph.links[f.link];o.disconnectInput(u),(this.allow_reconnect_links||t.shiftKey)&&(this.connecting_node=this.graph._nodes_by_id[_.origin_id],this.connecting_slot=_.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot)),this.dirty_bgcanvas=!0,i=!0}}}if(!i&&c(t.canvasX,t.canvasY,o.pos[0],o.pos[1]-e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT)&&(o.collapse(),i=!0),!i){var v=!1,y=this.processNodeWidgets(o,this.canvas_mouse,t);y&&(v=!0,this.node_widget=[o,y]),r&&this.selected_nodes[o.id]&&(o.onDblClick&&o.onDblClick(t,[t.canvasX-o.pos[0],t.canvasY-o.pos[1]],o),this.processNodeDblClicked(o),v=!0),o.onMouseDown&&o.onMouseDown(t,[t.canvasX-o.pos[0],t.canvasY-o.pos[1]],this)?v=!0:this.live_mode&&(l=!0,v=!0),v||(this.allow_dragnodes&&(this.node_dragged=o),this.selected_nodes[o.id]||this.processNodeSelected(o,t)),this.dirty_canvas=!0}}else{if(this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group){t.ctrlKey&&(this.dragging_rectangle=null);var m=p([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);m*this.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}r&&this.showSearchBox(t),l=!0}!i&&l&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2==t.which||3==t.which&&this.processContextMenu(o,t);return this.last_mouse[0]=t.localX,this.last_mouse[1]=t.localY,this.last_mouseclick=e.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!n.document.activeElement||"input"!=n.document.activeElement.nodeName.toLowerCase()&&"textarea"!=n.document.activeElement.nodeName.toLowerCase())&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}},s.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.graph){s.active_canvas=this,this.adjustMouseEvent(t);var n=[t.localX,t.localY],o=[n[0]-this.last_mouse[0],n[1]-this.last_mouse[1]];if(this.last_mouse=n,this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.canvas_mouse,t,this.node_widget[1]),this.dirty_canvas=!0),this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var i=o[0]/this.scale,a=o[1]/this.scale;this.selected_group.move(i,a,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.offset[0]+=o[0]/this.scale,this.offset[1]+=o[1]/this.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if(this.allow_interaction){this.connecting_node&&(this.dirty_canvas=!0);for(var r=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes),l=0,u=this.graph._nodes.length;l<u;++l)this.graph._nodes[l].mouseOver&&r!=this.graph._nodes[l]&&(this.graph._nodes[l].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(r){if(r.mouseOver||(r.mouseOver=!0,this.node_over=r,this.dirty_canvas=!0,r.onMouseEnter&&r.onMouseEnter(t)),r.onMouseMove&&r.onMouseMove(t,[t.canvasX-r.pos[0],t.canvasY-r.pos[1]],this),this.connecting_node){var p=this._highlight_input||[0,0];if(this.isOverNodeBox(r,t.canvasX,t.canvasY));else{var h=this.isOverNodeInput(r,t.canvasX,t.canvasY,p);if(-1!=h&&r.inputs[h]){var d=r.inputs[h].type;e.isValidConnection(this.connecting_output.type,d)&&(this._highlight_input=p)}else this._highlight_input=null}}this.canvas&&(c(t.canvasX,t.canvasY,r.pos[0]+r.size[0]-5,r.pos[1]+r.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="")}else this.canvas&&(this.canvas.style.cursor="");if(this.node_capturing_input&&this.node_capturing_input!=r&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t),this.node_dragged&&!this.live_mode){for(var l in this.selected_nodes){var g=this.selected_nodes[l];g.pos[0]+=o[0]/this.scale,g.pos[1]+=o[1]/this.scale}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){this.resizing_node.size[0]=t.canvasX-this.resizing_node.pos[0],this.resizing_node.size[1]=t.canvasY-this.resizing_node.pos[1];var f=Math.max(this.resizing_node.inputs?this.resizing_node.inputs.length:0,this.resizing_node.outputs?this.resizing_node.outputs.length:0),_=f*e.NODE_SLOT_HEIGHT+(this.resizing_node.widgets?this.resizing_node.widgets.length:0)*(e.NODE_WIDGET_HEIGHT+4)+4;this.resizing_node.size[1]<_&&(this.resizing_node.size[1]=_),this.resizing_node.size[0]<e.NODE_MIN_WIDTH&&(this.resizing_node.size[0]=e.NODE_MIN_WIDTH),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},s.prototype.processMouseUp=function(t){if(this.graph){var n=this.getCanvasWindow(),o=n.document;s.active_canvas=this,o.removeEventListener("mousemove",this._mousemove_callback,!0),this.canvas.addEventListener("mousemove",this._mousemove_callback,!0),o.removeEventListener("mouseup",this._mouseup_callback,!0),this.adjustMouseEvent(t);var i=e.getTime();if(t.click_time=i-this.last_mouseclick,this.last_mouse_dragging=!1,1==t.which){if(this.node_widget=null,this.selected_group){var a=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),r=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(a,r,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}if(this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){var l=this.graph._nodes,u=new Float32Array(4);this.deselectAllNodes();var p=Math.abs(this.dragging_rectangle[2]),h=Math.abs(this.dragging_rectangle[3]),c=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-p:this.dragging_rectangle[0],d=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-h:this.dragging_rectangle[1];this.dragging_rectangle[0]=c,this.dragging_rectangle[1]=d,this.dragging_rectangle[2]=p,this.dragging_rectangle[3]=h;for(var g=[],_=0;_<l.length;++_){var v=l[_];v.getBounding(u),f(this.dragging_rectangle,u)&&g.push(v)}g.length&&this.selectNodes(g)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;v=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(v)if(this.connecting_output.type==e.EVENT&&this.isOverNodeBox(v,t.canvasX,t.canvasY))this.connecting_node.connect(this.connecting_slot,v,e.EVENT);else{var y=this.isOverNodeInput(v,t.canvasX,t.canvasY);if(-1!=y)this.connecting_node.connect(this.connecting_slot,v,y);else{var m=v.getInputInfo(0);this.connecting_output.type==e.EVENT?this.connecting_node.connect(this.connecting_slot,v,e.EVENT):m&&!m.link&&e.isValidConnection(m.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,v,0)}}this.connecting_output=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.resizing_node=null;else if(this.node_dragged)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),this.graph.config.align_to_grid&&this.node_dragged.alignToGrid(),this.node_dragged=null;else{v=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);!v&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]])}}else 2==t.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==t.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},s.prototype.processMouseWheel=function(t){if(this.graph&&this.allow_dragcanvas){var e=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail;this.adjustMouseEvent(t);var n=this.scale;return e>0?n*=1.1:e<0&&(n*=1/1.1),this.setZoom(n,[t.localX,t.localY]),this.graph.change(),t.preventDefault(),!1}},s.prototype.isOverNodeBox=function(t,n,o){var i=e.NODE_TITLE_HEIGHT;return!!c(n,o,t.pos[0]+2,t.pos[1]+2-i,i-4,i-4)},s.prototype.isOverNodeInput=function(t,e,n,o){if(t.inputs)for(var i=0,s=t.inputs.length;i<s;++i){t.inputs[i];var a=t.getConnectionPos(!0,i);if(c(e,n,a[0]-10,a[1]-5,20,10))return o&&(o[0]=a[0],o[1]=a[1]),i}return-1},s.prototype.processKey=function(t){if(this.graph){var e=!1;if("input"!=t.target.localName){if("keydown"==t.type){if(32==t.keyCode&&(this.dragging_canvas=!0,e=!0),65==t.keyCode&&t.ctrlKey&&(this.selectNodes(),e=!0),"KeyC"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.selected_nodes&&(this.copyToClipboard(),e=!0),"KeyV"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.pasteFromClipboard(),46!=t.keyCode&&8!=t.keyCode||"input"!=t.target.localName&&"textarea"!=t.target.localName&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var n in this.selected_nodes)this.selected_nodes[n].onKeyDown&&this.selected_nodes[n].onKeyDown(t)}else if("keyup"==t.type&&(32==t.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(var n in this.selected_nodes)this.selected_nodes[n].onKeyUp&&this.selected_nodes[n].onKeyUp(t);return this.graph.change(),e?(t.preventDefault(),!1):void 0}}},s.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,n=[];for(var o in this.selected_nodes){var i=this.selected_nodes[o];i._relative_id=e,n.push(i),e+=1}for(o=0;o<n.length;++o){i=n[o];if(t.nodes.push(i.clone().serialize()),i.inputs&&i.inputs.length)for(var s=0;s<i.inputs.length;++s){var a=i.inputs[s];if(a&&null!=a.link){var r=this.graph.links[a.link];if(r){var l=this.graph.getNodeById(r.origin_id);l&&this.selected_nodes[l.id]&&t.links.push([l._relative_id,s,i._relative_id,r.target_slot])}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},s.prototype.pasteFromClipboard=function(){var t=localStorage.getItem("litegrapheditor_clipboard");if(t){for(var n=JSON.parse(t),o=[],i=0;i<n.nodes.length;++i){var s=n.nodes[i],a=e.createNode(s.type);a&&(a.configure(s),a.pos[0]+=5,a.pos[1]+=5,this.graph.add(a),o.push(a))}for(i=0;i<n.links.length;++i){var r=n.links[i],l=o[r[0]],u=o[r[2]];l.connect(r[1],u,r[3])}this.selectNodes(o)}},s.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=[t.canvasX,t.canvasY],n=this.graph.getNodeOnPos(e[0],e[1]);if(!n){var o=null;return this.onDropItem&&(o=this.onDropItem(event)),void(o||this.checkDropItem(t))}if(n.onDropFile||n.onDropData){var i=t.dataTransfer.files;if(i&&i.length)for(var a=0;a<i.length;a++){var r=t.dataTransfer.files[0],l=r.name;s.getFileExtension(l);if(n.onDropFile&&n.onDropFile(r),n.onDropData){var u=new FileReader;u.onload=function(t){var e=t.target.result;n.onDropData(e,l,r)};var p=r.type.split("/")[0];"text"==p||""==p?u.readAsText(r):"image"==p?u.readAsDataURL(r):u.readAsArrayBuffer(r)}}}return!(!n.onDropItem||!n.onDropItem(event))||!!this.onDropItem&&this.onDropItem(event)},s.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var n=t.dataTransfer.files[0],o=s.getFileExtension(n.name).toLowerCase(),i=e.node_types_by_file_extension[o];if(i){var a=e.createNode(i.type);a.pos=[t.canvasX,t.canvasY],this.graph.add(a),a.onDropFile&&a.onDropFile(n)}}},s.prototype.processNodeDblClicked=function(t){this.onShowNodePanel&&this.onShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},s.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&e.shiftKey),this.onNodeSelected&&this.onNodeSelected(t)},s.prototype.processNodeDeselected=function(t){this.deselectNode(t),this.onNodeDeselected&&this.onNodeDeselected(t)},s.prototype.selectNode=function(t,e){null==t?this.deselectAllNodes():this.selectNodes([t],e)},s.prototype.selectNodes=function(t,e){e||this.deselectAllNodes(),t=t||this.graph._nodes;for(var n=0;n<t.length;++n){var o=t[n];if(!o.selected){if(!o.selected&&o.onSelected&&o.onSelected(),o.selected=!0,this.selected_nodes[o.id]=o,o.inputs)for(var i=0;i<o.inputs.length;++i)this.highlighted_links[o.inputs[i].link]=!0;if(o.outputs)for(i=0;i<o.outputs.length;++i){var s=o.outputs[i];if(s.links)for(var a=0;a<s.links.length;++a)this.highlighted_links[s.links[a]]=!0}}}this.setDirty(!0)},s.prototype.deselectNode=function(t){if(t.selected){if(t.onDeselected&&t.onDeselected(),t.selected=!1,t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(e=0;e<t.outputs.length;++e){var n=t.outputs[e];if(n.links)for(var o=0;o<n.links.length;++o)delete this.highlighted_links[n.links[o]]}}},s.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,n=t.length;e<n;++e){var o=t[e];o.selected&&(o.onDeselected&&o.onDeselected(),o.selected=!1)}this.selected_nodes={},this.highlighted_links={},this.setDirty(!0)}},s.prototype.deleteSelectedNodes=function(){for(var t in this.selected_nodes){var e=this.selected_nodes[t];this.graph.remove(e)}this.selected_nodes={},this.highlighted_links={},this.setDirty(!0)},s.prototype.centerOnNode=function(t){this.offset[0]=-t.pos[0]-.5*t.size[0]+.5*this.canvas.width/this.scale,this.offset[1]=-t.pos[1]-.5*t.size[1]+.5*this.canvas.height/this.scale,this.setDirty(!0,!0)},s.prototype.adjustMouseEvent=function(t){if(this.canvas){var e=this.canvas.getBoundingClientRect();t.localX=t.pageX-e.left,t.localY=t.pageY-e.top}else t.localX=t.pageX,t.localY=t.pageY;t.deltaX=t.localX-this.last_mouse_position[0],t.deltaY=t.localY-this.last_mouse_position[1],this.last_mouse_position[0]=t.localX,this.last_mouse_position[1]=t.localY,t.canvasX=t.localX/this.scale-this.offset[0],t.canvasY=t.localY/this.scale-this.offset[1]},s.prototype.setZoom=function(t,e){!e&&this.canvas&&(e=[.5*this.canvas.width,.5*this.canvas.height]);var n=this.convertOffsetToCanvas(e);this.scale=t,this.scale>this.max_zoom?this.scale=this.max_zoom:this.scale<this.min_zoom&&(this.scale=this.min_zoom);var o=this.convertOffsetToCanvas(e),i=[o[0]-n[0],o[1]-n[1]];this.offset[0]+=i[0],this.offset[1]+=i[1],this.dirty_canvas=!0,this.dirty_bgcanvas=!0},s.prototype.convertOffsetToCanvas=function(t,e){return e=e||[],e[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},s.prototype.convertCanvasToOffset=function(t,e){return e=e||[],e[0]=(t[0]+this.offset[0])*this.scale,e[1]=(t[1]+this.offset[1])*this.scale,e},s.prototype.convertEventToCanvas=function(t){var e=this.canvas.getBoundingClientRect();return this.convertOffsetToCanvas([t.pageX-e.left,t.pageY-e.top])},s.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},s.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var a=new Float32Array(4);s.prototype.computeVisibleNodes=function(t,e){var n=e||[];n.length=0,t=t||this.graph._nodes;for(var o=0,i=t.length;o<i;++o){var s=t[o];(!this.live_mode||s.onDrawBackground||s.onDrawForeground)&&(f(this.visible_area,s.getBounding(a))&&n.push(s))}return n},s.prototype.draw=function(t,n){if(this.canvas){var o=e.getTime();if(this.render_time=.001*(o-this.last_draw_time),this.last_draw_time=o,this.graph){var i=-this.offset[0],s=-this.offset[1],a=i+this.canvas.width/this.scale,r=s+this.canvas.height/this.scale;this.visible_area[0]=i,this.visible_area[1]=s,this.visible_area[2]=a-i,this.visible_area[3]=r-s}(this.dirty_bgcanvas||n||this.always_render_background||this.graph&&this.graph._last_trigger_time&&o-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},s.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){t.start2D&&t.start2D();var n=this.canvas;if(t.restore(),t.setTransform(1,0,0,1,0,0),this.dirty_area&&(t.save(),t.beginPath(),t.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),t.clip()),this.clear_background&&t.clearRect(0,0,n.width,n.height),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(n,t),this.show_info&&this.renderInfo(t),this.graph){t.save(),t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1]);for(var o=this.computeVisibleNodes(null,this.visible_nodes),i=0;i<o.length;++i){var s=o[i];t.save(),t.translate(s.pos[0],s.pos[1]),this.drawNode(s,t),1,t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),null!=this.connecting_pos){t.lineWidth=this.connections_width;var a=null;switch(this.connecting_output.type){case e.EVENT:a=e.EVENT_LINK_COLOR;break;default:a=e.CONNECTING_LINK_COLOR}this.renderLink(t,this.connecting_pos,[this.canvas_mouse[0],this.canvas_mouse[1]],null,!1,null,a,this.connecting_output.dir||(this.connecting_node.flags.horizontal?e.DOWN:e.RIGHT),e.CENTER),t.beginPath(),this.connecting_output.type===e.EVENT||this.connecting_output.shape===e.BOX_SHAPE?t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI),t.fill(),t.fillStyle="#ffcc00",this._highlight_input&&(t.beginPath(),t.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this.onDrawOverlay&&this.onDrawOverlay(t),this.dirty_area&&t.restore(),t.finish2D&&t.finish2D()}},s.prototype.renderInfo=function(t,e,n){e=e||0,n=n||0,t.save(),t.translate(e,n),t.font="10px Arial",t.fillStyle="#888",this.graph?(t.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+this.graph.iteration,5,26),t.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),t.fillText("V: "+this.graph._version,5,52),t.fillText("FPS:"+this.fps.toFixed(2),5,65)):t.fillText("No graph selected",5,13),t.restore()},s.prototype.drawBackCanvas=function(){var t=this.bgcanvas;t.width==this.canvas.width&&t.height==this.canvas.height||(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;if(e.start&&e.start(),this.clear_background&&e.clearRect(0,0,t.width,t.height),this._graph_stack&&this._graph_stack.length){e.save();this._graph_stack[this._graph_stack.length-1];var n=this.graph._subgraph_node;e.strokeStyle=n.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=n.bgcolor;for(var o="",i=1;i<this._graph_stack.length;++i)o+=this._graph_stack[i]._subgraph_node.getTitle()+" >> ";e.fillText(o+n.getTitle(),.5*t.width,40),e.restore()}var s=!1;if(this.onRenderBackground&&(s=this.onRenderBackground(t,e)),e.restore(),e.setTransform(1,0,0,1,0,0),this.graph){if(e.save(),e.scale(this.scale,this.scale),e.translate(this.offset[0],this.offset[1]),this.background_image&&this.scale>.5&&!s){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var a=this;this._bg_img.onload=function(){a.draw(!0,!0)}}var r=null;null==this._pattern&&this._bg_img.width>0?(r=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=r):r=this._pattern,r&&(e.fillStyle=r,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var r=new Float32Array(2);s.prototype.drawNode=function(t,n){this.current_node=t;var o=t.color||t.constructor.color||e.NODE_DEFAULT_COLOR,i=t.bgcolor||t.constructor.bgcolor||e.NODE_DEFAULT_BGCOLOR;if(t.mouseOver&&!0,this.live_mode)t.flags.collapsed||(n.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(n,this,this.canvas));else{var s=this.editor_alpha;if(n.globalAlpha=s,this.render_shadows?(n.shadowColor=e.DEFAULT_SHADOW_COLOR,n.shadowOffsetX=2*this.scale,n.shadowOffsetY=2*this.scale,n.shadowBlur=3*this.scale):n.shadowColor="transparent",!t.flags.collapsed||!t.onDrawCollaped||1!=t.onDrawCollapsed(n,this)){var a=t._shape||e.BOX_SHAPE,l=r;if(r.set(t.size),t.flags.collapsed){n.font=this.inner_text_font;var u=t.getTitle?t.getTitle():t.title;t._collapsed_width=Math.min(t.size[0],n.measureText(u).width+40),l[0]=t._collapsed_width,l[1]=0}t.flags.clip_area&&(n.save(),n.beginPath(),a==e.BOX_SHAPE?n.rect(0,0,l[0],l[1]):a==e.ROUND_SHAPE?n.roundRect(0,0,l[0],l[1],10):a==e.CIRCLE_SHAPE&&n.arc(.5*l[0],.5*l[1],.5*l[0],0,2*Math.PI),n.clip()),this.drawNodeShape(t,n,l,o,i,t.selected,t.mouseOver),n.shadowColor="transparent",n.textAlign=t.flags.horizontal?"center":"left",n.font=this.inner_text_font;var p=this.scale>.6,h=this.connecting_output;n.lineWidth=1;var c=0,d=new Float32Array(2);if(t.flags.collapsed){var g=null,f=null;if(t.inputs)for(y=0;y<t.inputs.length;y++){m=t.inputs[y];if(null!=m.link){g=m;break}}if(t.outputs)for(y=0;y<t.outputs.length;y++){m=t.outputs[y];m.links&&m.links.length&&(f=m)}if(g){var _=0,v=-.5*e.NODE_TITLE_HEIGHT;t.flags.horizontal&&(_=.5*t._collapsed_width,v=-e.NODE_TITLE_HEIGHT),n.fillStyle=m.color_on||this.default_connection_color.input_on,n.beginPath(),m.type===e.EVENT||m.shape===e.BOX_SHAPE?n.rect(_-7+.5,v+4-.5*e.NODE_TITLE_HEIGHT+.5,14,e.NODE_TITLE_HEIGHT-8):m.shape===e.ARROW_SHAPE?(n.moveTo(_+8,v),n.lineTo(_+-4,v-4),n.lineTo(_+-4,v+4),n.closePath()):n.arc(_,v,4,0,2*Math.PI),n.fill()}if(f){_=t._collapsed_width,v=-.5*e.NODE_TITLE_HEIGHT;t.flags.horizontal&&(_=.5*t._collapsed_width,v=0),n.fillStyle=m.color_on||this.default_connection_color.output_on,n.strokeStyle="black",n.beginPath(),m.type===e.EVENT||m.shape===e.BOX_SHAPE?n.rect(_-7+.5,v+4-.5*e.NODE_TITLE_HEIGHT+.5,14,e.NODE_TITLE_HEIGHT-8):m.shape===e.ARROW_SHAPE?(n.moveTo(_+6,v),n.lineTo(_-6,v-4),n.lineTo(_-6,v+4),n.closePath()):n.arc(_,v,4,0,2*Math.PI),n.fill(),n.stroke()}}else{if(t.inputs)for(var y=0;y<t.inputs.length;y++){var m=t.inputs[y];n.globalAlpha=s,this.connecting_node&&e.isValidConnection(m.type&&h.type)&&(n.globalAlpha=.4*s),n.fillStyle=null!=m.link?m.color_on||this.default_connection_color.input_on:m.color_off||this.default_connection_color.input_off;var b=t.getConnectionPos(!0,y,d);if(b[0]-=t.pos[0],b[1]-=t.pos[1],c<b[1]+.5*e.NODE_SLOT_HEIGHT&&(c=b[1]+.5*e.NODE_SLOT_HEIGHT),n.beginPath(),m.type===e.EVENT||m.shape===e.BOX_SHAPE?n.rect(b[0]-6+.5,b[1]-5+.5,14,10):m.shape===e.ARROW_SHAPE?(n.moveTo(b[0]+8,b[1]+.5),n.lineTo(b[0]-4,b[1]+6+.5),n.lineTo(b[0]-4,b[1]-6+.5),n.closePath()):n.arc(b[0],b[1],4,0,2*Math.PI),n.fill(),p){var E=null!=m.label?m.label:m.name;E&&(n.fillStyle=e.NODE_TEXT_COLOR,t.flags.horizontal||m.dir==e.UP?n.fillText(E,b[0],b[1]-10):n.fillText(E,b[0]+10,b[1]+5))}}if(this.connecting_node&&(n.globalAlpha=.4*s),n.textAlign=t.flags.horizontal?"center":"right",n.strokeStyle="black",t.outputs)for(var y=0;y<t.outputs.length;y++){var m=t.outputs[y];b=t.getConnectionPos(!1,y,d);if(b[0]-=t.pos[0],b[1]-=t.pos[1],c<b[1]+.5*e.NODE_SLOT_HEIGHT&&(c=b[1]+.5*e.NODE_SLOT_HEIGHT),n.fillStyle=m.links&&m.links.length?m.color_on||this.default_connection_color.output_on:m.color_off||this.default_connection_color.output_off,n.beginPath(),m.type===e.EVENT||m.shape===e.BOX_SHAPE?n.rect(b[0]-6+.5,b[1]-5+.5,14,10):m.shape===e.ARROW_SHAPE?(n.moveTo(b[0]+8,b[1]+.5),n.lineTo(b[0]-4,b[1]+6+.5),n.lineTo(b[0]-4,b[1]-6+.5),n.closePath()):n.arc(b[0],b[1],4,0,2*Math.PI),n.fill(),n.stroke(),p){E=null!=m.label?m.label:m.name;E&&(n.fillStyle=e.NODE_TEXT_COLOR,t.flags.horizontal||m.dir==e.DOWN?n.fillText(E,b[0],b[1]-8):n.fillText(E,b[0]-10,b[1]+5))}}n.textAlign="left",n.globalAlpha=1,t.widgets&&((t.flags.horizontal||t.flags.widgets_up)&&(c=2),this.drawNodeWidgets(t,c,n,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null)),t.onDrawForeground&&t.onDrawForeground(n,this,this.canvas)}t.flags.clip_area&&n.restore(),n.globalAlpha=1}}};var l=new Float32Array(4);function u(t,e){for(var n in t)if(t[n]!=e[n])return!1;return!0}function p(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function h(t){return"rgba("+Math.round(255*t[0]).toFixed()+","+Math.round(255*t[1]).toFixed()+","+Math.round(255*t[2]).toFixed()+","+(4==t.length?t[3].toFixed(2):"1.0")+")"}function c(t,e,n,o,i,s){return n<t&&n+i>t&&o<e&&o+s>e}function d(t,e,n){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),n<t[1]?t[1]=n:n>t[3]&&(t[3]=n)}function g(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}function f(t,e){var n=t[0]+t[2],o=t[1]+t[3],i=e[0]+e[2],s=e[1]+e[3];return!(t[0]>i||t[1]>s||n<e[0]||o<e[1])}function _(t){"#"==t.charAt(0)&&(t=t.slice(1)),t=t.toUpperCase();for(var e,n,o="0123456789ABCDEF",i=new Array(3),s=0,a=0;a<6;a+=2)e=o.indexOf(t.charAt(a)),n=o.indexOf(t.charAt(a+1)),i[s]=16*e+n,s++;return i}function v(t){for(var e,n,o="0123456789ABCDEF",i="#",s=0;s<3;s++)e=t[s]/16,n=t[s]%16,i+=o.charAt(e)+o.charAt(n);return i}function y(t,e){e=e||{},this.options=e;var n=this;e.parentMenu&&(e.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=null):(this.parentMenu=e.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this)),e.event&&e.event.constructor!==MouseEvent&&e.event.constructor!==CustomEvent&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),e.event=null);var o=document.createElement("div");function i(t){var e=parseInt(o.style.top);return o.style.top=(e+.1*t.deltaY).toFixed()+"px",t.preventDefault(),!0}if(o.className="litegraph litecontextmenu litemenubar-panel",e.className&&(o.className+=" "+e.className),o.style.minWidth=100,o.style.minHeight=100,o.style.pointerEvents="none",setTimeout(function(){o.style.pointerEvents="auto"},100),o.addEventListener("mouseup",function(t){return t.preventDefault(),!0},!0),o.addEventListener("contextmenu",function(t){return 2==t.button&&(t.preventDefault(),!1)},!0),o.addEventListener("mousedown",function(t){if(2==t.button)return n.close(),t.preventDefault(),!0},!0),o.addEventListener("wheel",i,!0),o.addEventListener("mousewheel",i,!0),this.root=o,e.title){var s=document.createElement("div");s.className="litemenu-title",s.innerHTML=e.title,o.appendChild(s)}for(var a in t){var r=t.constructor==Array?t[a]:a;null!=r&&r.constructor!==String&&(r=void 0===r.content?String(r):r.content);var l=t[a];this.addItem(r,l,e),0}o.addEventListener("mouseleave",function(t){n.lock||(o.closing_timer&&clearTimeout(o.closing_timer),o.closing_timer=setTimeout(n.close.bind(n,t),500))}),o.addEventListener("mouseenter",function(t){o.closing_timer&&clearTimeout(o.closing_timer)});var u=document;e.event&&(u=e.event.target.ownerDocument),u||(u=document),u.body.appendChild(o);var p=e.left||0,h=e.top||0;if(e.event){if(p=e.event.pageX-10,h=e.event.pageY-10,e.title&&(h-=20),e.parentMenu){var c=e.parentMenu.root.getBoundingClientRect();p=c.left+c.width}var d=document.body.getBoundingClientRect(),g=o.getBoundingClientRect();p>d.width-g.width-10&&(p=d.width-g.width-10),h>d.height-g.height-10&&(h=d.height-g.height-10)}o.style.left=p+"px",o.style.top=h+"px"}s.prototype.drawNodeShape=function(t,n,o,i,a,r,u){n.strokeStyle=i,n.fillStyle=a;var p=e.NODE_TITLE_HEIGHT,h=t._shape||t.constructor.shape||e.BOX_SHAPE,c=t.constructor.title_mode,d=!0;c==e.TRANSPARENT_TITLE?d=!1:c==e.AUTOHIDE_TITLE&&u&&(d=!0);var g=l;if(g[0]=0,g[1]=d?-p:0,g[2]=o[0]+1,g[3]=d?o[1]+p:o[1],t.flags.collapsed||(n.beginPath(),h==e.BOX_SHAPE||this.scale<.5?n.fillRect(g[0],g[1],g[2],g[3]):h==e.ROUND_SHAPE||h==e.CARD_SHAPE?n.roundRect(g[0],g[1],g[2],g[3],this.round_radius,h==e.CARD_SHAPE?0:this.round_radius):h==e.CIRCLE_SHAPE&&n.arc(.5*o[0],.5*o[1],.5*o[0],0,2*Math.PI),n.fill()),n.shadowColor="transparent",t.bgImage&&t.bgImage.width&&n.drawImage(t.bgImage,.5*(o[0]-t.bgImage.width),.5*(o[1]-t.bgImage.height)),t.bgImageUrl&&!t.bgImage&&(t.bgImage=t.loadImage(t.bgImageUrl)),t.onDrawBackground&&t.onDrawBackground(n,this,this.canvas),d||c==e.TRANSPARENT_TITLE){if(c!=e.TRANSPARENT_TITLE)//!node.flags.collapsed)
{if(t.flags.collapsed&&(n.shadowColor=e.DEFAULT_SHADOW_COLOR),this.use_gradients){var f=s.gradients[i];f||(f=s.gradients[i]=n.createLinearGradient(0,0,400,0),f.addColorStop(0,i),f.addColorStop(1,"#000")),n.fillStyle=f}else n.fillStyle=i;var _=n.globalAlpha;n.beginPath(),h==e.BOX_SHAPE||this.scale<.5?n.rect(0,-p,o[0]+1,p):h!=e.ROUND_SHAPE&&h!=e.CARD_SHAPE||n.roundRect(0,-p,o[0]+1,p,this.round_radius,t.flags.collapsed?this.round_radius:0),n.fill(),n.shadowColor="transparent"}if(h==e.ROUND_SHAPE||h==e.CIRCLE_SHAPE||h==e.CARD_SHAPE?(this.scale>.5&&(n.fillStyle="black",n.beginPath(),n.arc(.5*p,-.5*p,.5*(p-8),0,2*Math.PI),n.fill()),n.fillStyle=t.boxcolor||e.NODE_DEFAULT_BOXCOLOR,n.beginPath(),n.arc(.5*p,-.5*p,.4*(p-8),0,2*Math.PI),n.fill()):(this.scale>.5&&(n.fillStyle="black",n.fillRect(4,4-p,p-8,p-8)),n.fillStyle=t.boxcolor||e.NODE_DEFAULT_BOXCOLOR,n.fillRect(5,5-p,p-10,p-10)),n.globalAlpha=_,this.scale>.5){n.font=this.title_text_font;var v=t.getTitle();if(v)if(n.fillStyle=r?"white":t.constructor.title_text_color||this.node_title_color,t.flags.collapsed){n.textAlign="center";var y=n.measureText(v);n.fillText(v,p+.5*y.width,.2*-p),n.textAlign="left"}else n.textAlign="left",n.fillText(v,p,.2*-p)}t.onDrawTitle&&t.onDrawTitle(n)}r&&(t.onBounding&&t.onBounding(g),c==e.TRANSPARENT_TITLE&&(g[1]-=p,g[3]+=p),n.lineWidth=1,n.globalAlpha=.8,n.beginPath(),h==e.BOX_SHAPE?n.rect(-6+g[0],-6+g[1],12+g[2],12+g[3]):h==e.ROUND_SHAPE||h==e.CARD_SHAPE&&t.flags.collapsed?n.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],2*this.round_radius):h==e.CARD_SHAPE?n.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],2*this.round_radius,2):h==e.CIRCLE_SHAPE&&n.arc(.5*o[0],.5*o[1],.5*o[0]+6,0,2*Math.PI),n.strokeStyle="#FFF",n.stroke(),n.strokeStyle=i,n.globalAlpha=1)},s.prototype.drawConnections=function(t){var n=e.getTime(),o=this.visible_area,i=new Float32Array([o[0]-20,o[1]-20,o[2]+40,o[3]+40]),s=new Float32Array(4),a=new Float32Array(2),r=new Float32Array(2);t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var l=this.graph._nodes,u=0,p=l.length;u<p;++u){var h=l[u];if(h.inputs&&h.inputs.length)for(var c=0;c<h.inputs.length;++c){var d=h.inputs[c];if(d&&null!=d.link){var g=d.link,_=this.graph.links[g];if(_){var v=this.graph.getNodeById(_.origin_id);if(null!=v){var y=_.origin_slot,m=null;m=-1==y?[v.pos[0]+10,v.pos[1]+10]:v.getConnectionPos(!1,y,a);var b=h.getConnectionPos(!0,c,r);if(s[0]=m[0],s[1]=m[1],s[2]=b[0]-m[0],s[3]=b[1]-m[1],s[2]<0&&(s[0]+=s[2],s[2]=Math.abs(s[2])),s[3]<0&&(s[1]+=s[3],s[3]=Math.abs(s[3])),f(s,i)){var E=v.outputs[y],O=h.inputs[c];if(E&&O){var T=E.dir||(v.flags.horizontal?e.DOWN:e.RIGHT),k=O.dir||(h.flags.horizontal?e.UP:e.LEFT);if(this.renderLink(t,m,b,_,!1,0,null,T,k),_&&_._last_time&&n-_._last_time<1e3){var w=2-.002*(n-_._last_time),D=t.globalAlpha;t.globalAlpha=D*w,this.renderLink(t,m,b,_,!0,w,"white",T,k),t.globalAlpha=D}}}}}}}}t.globalAlpha=1},s.prototype.renderLink=function(t,n,o,i,a,r,l,u,h){if(!this.highquality_render)return t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(o[0],o[1]),void t.stroke();u=u||e.RIGHT,h=h||e.LEFT;var c=p(n,o);if(this.render_connections_border&&this.scale>.6&&(t.lineWidth=this.connections_width+4),!l&&i&&(l=i.color||s.link_type_colors[i.type]),l||(l=this.default_link_color),null!=i&&this.highlighted_links[i.id]&&(l="#FFF"),t.beginPath(),this.render_curved_connections){t.moveTo(n[0],n[1]);var d=0,g=0,f=0,_=0;switch(u){case e.LEFT:d=-.25*c;break;case e.RIGHT:d=.25*c;break;case e.UP:g=-.25*c;break;case e.DOWN:g=.25*c;break}switch(h){case e.LEFT:f=-.25*c;break;case e.RIGHT:f=.25*c;break;case e.UP:_=-.25*c;break;case e.DOWN:_=.25*c;break}t.bezierCurveTo(n[0]+d,n[1]+g,o[0]+f,o[1]+_,o[0],o[1])}else t.moveTo(n[0]+10,n[1]),t.lineTo(.5*(n[0]+10+(o[0]-10)),n[1]),t.lineTo(.5*(n[0]+10+(o[0]-10)),o[1]),t.lineTo(o[0]-10,o[1]);if(this.render_connections_border&&this.scale>.6&&!a&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=l,t.stroke(),this.render_connection_arrows&&this.scale>=.6&&this.render_connection_arrows&&this.scale>.6){var v=this.computeConnectionPoint(n,o,.5,u,h),y=this.computeConnectionPoint(n,o,.51,u,h),m=0;m=this.render_curved_connections?-Math.atan2(y[0]-v[0],y[1]-v[1]):o[1]>n[1]?0:Math.PI,t.save(),t.translate(v[0],v[1]),t.rotate(m),t.beginPath(),t.moveTo(-5,-5),t.lineTo(0,5),t.lineTo(5,-5),t.fill(),t.restore()}if(r)for(var b=0;b<5;++b){var E=(.001*e.getTime()+.2*b)%1;v=this.computeConnectionPoint(n,o,E,u,h);t.beginPath(),t.arc(v[0],v[1],5,0,2*Math.PI),t.fill()}},s.prototype.computeConnectionPoint=function(t,n,o,i,s){i=i||e.RIGHT,s=s||e.LEFT;var a=p(t,n),r=t,l=[t[0],t[1]],u=[n[0],n[1]],h=n;switch(i){case e.LEFT:l[0]+=-.25*a;break;case e.RIGHT:l[0]+=.25*a;break;case e.UP:l[1]+=-.25*a;break;case e.DOWN:l[1]+=.25*a;break}switch(s){case e.LEFT:u[0]+=-.25*a;break;case e.RIGHT:u[0]+=.25*a;break;case e.UP:u[1]+=-.25*a;break;case e.DOWN:u[1]+=.25*a;break}var c=(1-o)*(1-o)*(1-o),d=(1-o)*(1-o)*3*o,g=3*(1-o)*(o*o),f=o*o*o,_=c*r[0]+d*l[0]+g*u[0]+f*h[0],v=c*r[1]+d*l[1]+g*u[1]+f*h[1];return[_,v]},s.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var n=this.visible_nodes,o=0;o<n.length;++o){var i=n[o];t.fillStyle="black",t.fillRect(i.pos[0]-e.NODE_TITLE_HEIGHT,i.pos[1]-e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT),0==i.order&&t.strokeRect(i.pos[0]-e.NODE_TITLE_HEIGHT+.5,i.pos[1]-e.NODE_TITLE_HEIGHT+.5,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(i.order,i.pos[0]+-.5*e.NODE_TITLE_HEIGHT,i.pos[1]-6)}t.globalAlpha=1},s.prototype.drawNodeWidgets=function(t,n,o,i){if(!t.widgets||!t.widgets.length)return 0;var s=t.size[0],a=t.widgets;n+=2;var r=e.NODE_WIDGET_HEIGHT,l=this.scale>.5;o.save(),o.globalAlpha=this.editor_alpha;for(var u=0;u<a.length;++u){var p=a[u],h=n;switch(p.y&&(h=p.y),p.last_y=h,o.strokeStyle="#AAA",o.fillStyle="#222",o.textAlign="left",p.type){case"button":p.clicked&&(o.fillStyle="#AAA",p.clicked=!1,this.dirty_canvas=!0),o.fillRect(10,h,s-20,r),o.strokeRect(10,h,s-20,r),l&&(o.textAlign="center",o.fillStyle="#AAA",o.fillText(p.name,.5*s,h+.7*r));break;case"toggle":o.textAlign="left",o.strokeStyle="#AAA",o.fillStyle="#111",o.beginPath(),o.roundRect(10,n,s-20,r,.5*r),o.fill(),o.stroke(),o.fillStyle=p.value?"#89A":"#333",o.beginPath(),o.arc(s-20,h+.5*r,.36*r,0,2*Math.PI),o.fill(),l&&(o.fillStyle="#999",null!=p.name&&o.fillText(p.name,20,h+.7*r),o.fillStyle=p.value?"#DDD":"#888",o.textAlign="right",o.fillText(p.value?p.options.on||"true":p.options.off||"false",s-30,h+.7*r));break;case"slider":o.fillStyle="#111",o.fillRect(10,h,s-20,r);var c=p.options.max-p.options.min,d=(p.value-p.options.min)/c;o.fillStyle=i==p?"#89A":"#678",o.fillRect(10,h,d*(s-20),r),o.strokeRect(10,h,s-20,r),l&&(o.textAlign="center",o.fillStyle="#DDD",o.fillText(p.name+"  "+Number(p.value).toFixed(3),.5*s,h+.7*r));break;case"number":case"combo":o.textAlign="left",o.strokeStyle="#AAA",o.fillStyle="#111",o.beginPath(),o.roundRect(10,n,s-20,r,.5*r),o.fill(),o.stroke(),l&&(o.fillStyle="#AAA",o.beginPath(),o.moveTo(26,n+5),o.lineTo(16,n+.5*r),o.lineTo(26,n+r-5),o.moveTo(s-26,n+5),o.lineTo(s-16,n+.5*r),o.lineTo(s-26,n+r-5),o.fill(),o.fillStyle="#999",o.fillText(p.name,30,h+.7*r),o.fillStyle="#DDD",o.textAlign="right","number"==p.type?o.fillText(Number(p.value).toFixed(void 0!==p.options.precision?p.options.precision:3),s-40,h+.7*r):o.fillText(p.value,s-40,h+.7*r));break;case"text":o.textAlign="left",o.strokeStyle="#AAA",o.fillStyle="#111",o.beginPath(),o.roundRect(10,n,s-20,r,.5*r),o.fill(),o.stroke(),l&&(o.fillStyle="#999",null!=p.name&&o.fillText(p.name,20,h+.7*r),o.fillStyle="#DDD",o.textAlign="right",o.fillText(p.value,s-20,h+.7*r));break;default:p.draw&&p.draw(o,t,p,h,r);break}n+=r+4}o.restore()},s.prototype.processNodeWidgets=function(t,n,o,i){if(!t.widgets||!t.widgets.length)return null;for(var s=n[0]-t.pos[0],a=n[1]-t.pos[1],r=t.size[0],l=this,u=this.getCanvasWindow(),p=0;p<t.widgets.length;++p){var h=t.widgets[p];if(h==i||s>6&&s<r-12&&a>h.last_y&&a<h.last_y+e.NODE_WIDGET_HEIGHT){switch(h.type){case"button":h.callback&&setTimeout(function(){h.callback(h,l,t,n)},20),h.clicked=!0,this.dirty_canvas=!0;break;case"slider":h.options.max,h.options.min;var c=Math.clamp((s-10)/(r-20),0,1);h.value=h.options.min+(h.options.max-h.options.min)*c,h.callback&&setTimeout(function(){h.callback(h.value,l,t,n)},20),this.dirty_canvas=!0;break;case"number":case"combo":if("mousemove"==o.type&&"number"==h.type)h.value+=.1*o.deltaX*(h.options.step||1),null!=h.options.min&&h.value<h.options.min&&(h.value=h.options.min),null!=h.options.max&&h.value>h.options.max&&(h.value=h.options.max);else if("mousedown"==o.type){var d=h.options.values;d&&d.constructor===Function&&(d=h.options.values(h,t));var g=s<40?-1:s>r-40?1:0;if("number"==h.type)h.value+=.1*g*(h.options.step||1),null!=h.options.min&&h.value<h.options.min&&(h.value=h.options.min),null!=h.options.max&&h.value>h.options.max&&(h.value=h.options.max);else if(g){var f=d.indexOf(h.value)+g;f>=d.length&&(f=0),f<0&&(f=d.length-1),h.value=d[f]}else{new e.ContextMenu(d,{event:o,className:"dark",callback:_.bind(h)},u);function _(t,e,n){return this.value=t,l.dirty_canvas=!0,!1}}}h.callback&&setTimeout(function(){this.callback(this.value,l,t,n)}.bind(h),20),this.dirty_canvas=!0;break;case"toggle":"mousedown"==o.type&&(h.value=!h.value,h.callback&&setTimeout(function(){h.callback(h.value,l,t,n)},20));break;case"text":"mousedown"==o.type&&this.prompt("Value",h.value,function(e){this.value=e,h.callback&&h.callback(e,l,t)}.bind(h),o);break;default:h.mouse&&h.mouse(ctx,o,[s,a],t);break}return h}}return null},s.prototype.drawGroups=function(t,n){if(this.graph){var o=this.graph._groups;n.save(),n.globalAlpha=.5*this.editor_alpha;for(var i=0;i<o.length;++i){var s=o[i];if(f(this.visible_area,s._bounding)){n.fillStyle=s.color||"#335",n.strokeStyle=s.color||"#335";var a=s._pos,r=s._size;n.globalAlpha=.25*this.editor_alpha,n.beginPath(),n.rect(a[0]+.5,a[1]+.5,r[0],r[1]),n.fill(),n.globalAlpha=this.editor_alpha,n.stroke(),n.beginPath(),n.moveTo(a[0]+r[0],a[1]+r[1]),n.lineTo(a[0]+r[0]-10,a[1]+r[1]),n.lineTo(a[0]+r[0],a[1]+r[1]-10),n.fill();var l=s.font_size||e.DEFAULT_GROUP_FONT_SIZE;n.font=l+"px Arial",n.fillText(s.title,a[0]+4,a[1]+l)}}n.restore()}},s.prototype.resize=function(t,e){if(!t&&!e){var n=this.canvas.parentNode;t=n.offsetWidth,e=n.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},s.prototype.switchLiveMode=function(t){if(!t)return this.live_mode=!this.live_mode,this.dirty_canvas=!0,void(this.dirty_bgcanvas=!0);var e=this,n=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var o=setInterval(function(){e.editor_alpha*=n,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,n<1&&e.editor_alpha<.01&&(clearInterval(o),n<1&&(e.live_mode=!0)),n>1&&e.editor_alpha>.99&&(clearInterval(o),e.editor_alpha=1)},1)},s.prototype.onNodeSelectionChange=function(t){},s.prototype.touchHandler=function(t){var e=t.changedTouches,n=e[0],o="";switch(t.type){case"touchstart":o="mousedown";break;case"touchmove":o="mousemove";break;case"touchend":o="mouseup";break;default:return}var i=this.getCanvasWindow(),s=i.document,a=s.createEvent("MouseEvent");a.initMouseEvent(o,!0,!0,i,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(a),t.preventDefault()},s.onGroupAdd=function(t,n,o){var i=s.active_canvas,a=(i.getCanvasWindow(),new e.LGraphGroup);a.pos=i.convertEventToCanvas(o),i.graph.add(a)},s.onMenuAdd=function(t,n,o,i){var a=s.active_canvas,r=a.getCanvasWindow(),l=e.getNodeTypesCategories(),u=[];for(var p in l)l[p]&&u.push({value:l[p],content:l[p],has_submenu:!0});var h=new e.ContextMenu(u,{event:o,callback:c,parentMenu:i},r);function c(t,n,o){var i=t.value,s=e.getNodeTypesInCategory(i,a.filter),l=[];for(var u in s)s[u].skip_list||l.push({content:s[u].title,value:s[u].type});return new e.ContextMenu(l,{event:o,callback:d,parentMenu:h},r),!1}function d(t,n){var o=i.getFirstEvent(),s=e.createNode(t.value);s&&(s.pos=a.convertEventToCanvas(o),a.graph.add(s))}return!1},s.onMenuCollapseAll=function(){},s.onMenuNodeEdit=function(){},s.showMenuNodeOptionalInputs=function(t,n,o,i,a){if(a){var r=this,l=s.active_canvas,u=l.getCanvasWindow();n=a.optional_inputs;a.onGetInputs&&(n=a.onGetInputs());var p=[];if(n)for(var h in n){var c=n[h];if(c){var d=c[0];c[2]&&c[2].label&&(d=c[2].label);var g={content:d,value:c};c[1]==e.ACTION&&(g.className="event"),p.push(g)}else p.push(null)}if(this.onMenuNodeInputs&&(p=this.onMenuNodeInputs(p)),p.length){new e.ContextMenu(p,{event:o,callback:f,parentMenu:i,node:a},u);return!1}}function f(t,e,n){a&&(t.callback&&t.callback.call(r,a,t,e,n),t.value&&(a.addInput(t.value[0],t.value[1],t.value[2]),a.setDirtyCanvas(!0,!0)))}},s.showMenuNodeOptionalOutputs=function(t,n,o,i,a){if(a){var r=this,l=s.active_canvas,u=l.getCanvasWindow();n=a.optional_outputs;a.onGetOutputs&&(n=a.onGetOutputs());var p=[];if(n)for(var h in n){var c=n[h];if(c){if(!a.flags||!a.flags.skip_repeated_outputs||-1==a.findOutputSlot(c[0])){var d=c[0];c[2]&&c[2].label&&(d=c[2].label);var g={content:d,value:c};c[1]==e.EVENT&&(g.className="event"),p.push(g)}}else p.push(null)}if(this.onMenuNodeOutputs&&(p=this.onMenuNodeOutputs(p)),p.length){new e.ContextMenu(p,{event:o,callback:f,parentMenu:i,node:a},u);return!1}}function f(t,n,o){if(a&&(t.callback&&t.callback.call(r,a,t,n,o),t.value)){var s=t.value[1];if(s&&(s.constructor===Object||s.constructor===Array)){var l=[];for(var u in s)l.push({content:u,value:s[u]});return new e.ContextMenu(l,{event:n,callback:f,parentMenu:i,node:a}),!1}a.addOutput(t.value[0],t.value[1],t.value[2]),a.setDirtyCanvas(!0,!0)}}},s.onShowMenuNodeProperties=function(t,n,o,i,a){if(a&&a.properties){var r=s.active_canvas,l=r.getCanvasWindow(),u=[];for(var p in a.properties){t=void 0!==a.properties[p]?a.properties[p]:" ";t=s.decodeHTML(t),u.push({content:"<span class='property_name'>"+p+"</span><span class='property_value'>"+t+"</span>",value:p})}if(u.length){new e.ContextMenu(u,{event:o,callback:h,parentMenu:i,allow_html:!0,node:a},l);return!1}}function h(t,e,n,o){if(a){var i=this.getBoundingClientRect();r.showEditPropertyValue(a,t.value,{position:[i.left,i.top]})}}},s.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},s.onResizeNode=function(t,e,n,o,i){i&&(i.size=i.computeSize(),i.setDirtyCanvas(!0,!0))},s.onShowPropertyEditor=function(t,e,n,o,i){var a=t.property||"title",r=i[a],l=document.createElement("div");l.className="graphdialog",l.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>";var u=l.querySelector(".name");u.innerText=a;var p=l.querySelector("input");p&&(p.value=r,p.addEventListener("blur",function(t){this.focus()}),p.addEventListener("keydown",function(t){13==t.keyCode&&(v(),t.preventDefault(),t.stopPropagation())}));var h=s.active_canvas,c=h.canvas,d=c.getBoundingClientRect(),g=-20,f=-20;d&&(g-=d.left,f-=d.top),event?(l.style.left=event.pageX+g+"px",l.style.top=event.pageY+f+"px"):(l.style.left=.5*c.width+g+"px",l.style.top=.5*c.height+f+"px");var _=l.querySelector("button");function v(){y(p.value)}function y(e){"Number"==t.type?e=Number(e):"Boolean"==t.type&&(e=Boolean(e)),i[a]=e,l.parentNode.removeChild(l),i.setDirtyCanvas(!0,!0)}_.addEventListener("click",v),c.parentNode.appendChild(l)},s.prototype.prompt=function(t,e,n,o){var i=this;t=t||"";var a=document.createElement("div");a.className="graphdialog rounded",a.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",a.close=function(){i.prompt_box=null,a.parentNode.removeChild(a)},a.addEventListener("mouseleave",function(t){a.close()}),i.prompt_box&&i.prompt_box.close(),i.prompt_box=a;var r=a.querySelector(".name");r.innerText=t;var l=a.querySelector(".value");l.value=e;var u=a.querySelector("input");u.addEventListener("keydown",function(t){if(27==t.keyCode)a.close();else{if(13!=t.keyCode)return;n&&n(this.value),a.close()}t.preventDefault(),t.stopPropagation()});var p=a.querySelector("button");p.addEventListener("click",function(t){n&&n(u.value),i.setDirty(!0),a.close()});var h=s.active_canvas,c=h.canvas,d=c.getBoundingClientRect(),g=-20,f=-20;return d&&(g-=d.left,f-=d.top),o?(a.style.left=o.pageX+g+"px",a.style.top=o.pageY+f+"px"):(a.style.left=.5*c.width+g+"px",a.style.top=.5*c.height+f+"px"),c.parentNode.appendChild(a),setTimeout(function(){u.focus()},10),a},s.search_limit=-1,s.prototype.showSearchBox=function(t){var n=this,o=document.createElement("div");o.className="litegraph litesearchbox graphdialog rounded",o.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>",o.close=function(){n.search_box=null,o.parentNode.removeChild(o)},o.addEventListener("mouseleave",function(t){o.close()}),n.search_box&&n.search_box.close(),n.search_box=o;var i=o.querySelector(".helper"),a=null,r=null,l=null,u=o.querySelector("input");u&&(u.addEventListener("blur",function(t){this.focus()}),u.addEventListener("keydown",function(t){if(38==t.keyCode)_(!1);else if(40==t.keyCode)_(!0);else if(27==t.keyCode)o.close();else{if(13!=t.keyCode)return r&&clearInterval(r),void(r=setTimeout(v,10));l?f(l.innerHTML):a?f(a):o.close()}t.preventDefault(),t.stopPropagation()}));var p=s.active_canvas,h=p.canvas,c=h.getBoundingClientRect(),d=-20,g=-20;function f(i){if(i)if(n.onSearchBoxSelection)n.onSearchBoxSelection(i,t,p);else{var s=e.searchbox_extras[i];s&&(i=s.type);var a=e.createNode(i);if(a&&(a.pos=p.convertEventToCanvas(t),p.graph.add(a)),s&&s.data){if(s.data.properties)for(var r in s.data.properties)a.addProperty(s.data.properties[r][0],s.data.properties[r][0]);if(s.data.inputs)for(var r in a.inputs=[],s.data.inputs)a.addOutput(s.data.inputs[r][0],s.data.inputs[r][1]);if(s.data.outputs)for(var r in a.outputs=[],s.data.outputs)a.addOutput(s.data.outputs[r][0],s.data.outputs[r][1]);s.data.title&&(a.title=s.data.title),s.data.json&&a.configure(s.data.json)}}o.close()}function _(t){var e=l;l&&l.classList.remove("selected"),l?(l=t?l.nextSibling:l.previousSibling,l||(l=e)):l=t?i.childNodes[0]:i.childNodes[i.childNodes.length],l&&(l.classList.add("selected"),l.scrollIntoView())}function v(){r=null;var t=u.value;if(a=null,i.innerHTML="",t)if(n.onSearchBox){var o=n.onSearchBox(help,t,p);if(o)for(var l=0;l<o.length;++l)_(o[l])}else{var h=0;for(var l in t=t.toLowerCase(),e.searchbox_extras){var c=e.searchbox_extras[l];if(-1!==c.desc.toLowerCase().indexOf(t)&&(_(c.desc,"searchbox_extra"),-1!==s.search_limit&&h++>s.search_limit))break}if(Array.prototype.filter){var d=Object.keys(e.registered_node_types),g=d.filter(function(e){return-1!==e.toLowerCase().indexOf(t)});for(l=0;l<g.length;l++)if(_(g[l]),-1!==s.search_limit&&h++>s.search_limit)break}else for(var l in e.registered_node_types)if(-1!=l.indexOf(t)&&(_(l),-1!==s.search_limit&&h++>s.search_limit))break}function _(t,e){var n=document.createElement("div");a||(a=t),n.innerText=t,n.dataset["type"]=escape(t),n.className="litegraph lite-search-item",e&&(n.className+=" "+e),n.addEventListener("click",function(t){f(unescape(this.dataset["type"]))}),i.appendChild(n)}}return c&&(d-=c.left,g-=c.top),t?(o.style.left=t.pageX+d+"px",o.style.top=t.pageY+g+"px"):(o.style.left=.5*h.width+d+"px",o.style.top=.5*h.height+g+"px"),h.parentNode.appendChild(o),u.focus(),o},s.prototype.showEditPropertyValue=function(t,e,n){if(t&&void 0!==t.properties[e]){n=n||{};var o="string";null!==t.properties[e]&&(o=typeof t.properties[e]),"object"==o&&t.properties[e].length&&(o="array");var i=null;if(t.getPropertyInfo&&(i=t.getPropertyInfo(e)),t.properties_info)for(var s=0;s<t.properties_info.length;++s)if(t.properties_info[s].name==e){i=t.properties_info[s];break}void 0!==i&&null!==i&&i.type&&(o=i.type);var a="";if("string"==o||"number"==o||"array"==o)a="<input autofocus type='text' class='value'/>";else if("enum"==o&&i.values){for(var s in a="<select autofocus type='text' class='value'>",i.values){var r=i.values.constructor===Array?i.values[s]:s;a+="<option value='"+r+"' "+(r==t.properties[e]?"selected":"")+">"+i.values[s]+"</option>"}a+="</select>"}else{if("boolean"!=o)return void console.warn("unknown type: "+o);a="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>"}var l=this.createDialog("<span class='name'>"+e+"</span>"+a+"<button>OK</button>",n);if("enum"==o&&i.values){var u=l.querySelector("select");u.addEventListener("change",function(t){c(t.target.value)})}else if("boolean"==o){u=l.querySelector("input");u&&u.addEventListener("click",function(t){c(!!u.checked)})}else{u=l.querySelector("input");u&&(u.addEventListener("blur",function(t){this.focus()}),u.value=void 0!==t.properties[e]?t.properties[e]:"",u.addEventListener("keydown",function(t){13==t.keyCode&&(h(),t.preventDefault(),t.stopPropagation())}))}var p=l.querySelector("button");p.addEventListener("click",h)}function h(){c(u.value)}function c(n){"number"==typeof t.properties[e]&&(n=Number(n)),"array"==o&&(n=n.split(",").map(Number)),t.properties[e]=n,t._graph&&t._graph._version++,t.onPropertyChanged&&t.onPropertyChanged(e,n),l.close(),t.setDirtyCanvas(!0,!0)}},s.prototype.createDialog=function(t,e){e=e||{};var n=document.createElement("div");n.className="graphdialog",n.innerHTML=t;var o=this.canvas.getBoundingClientRect(),i=-20,s=-20;return o&&(i-=o.left,s-=o.top),e.position?(i+=e.position[0],s+=e.position[1]):e.event?(i+=e.event.pageX,s+=e.event.pageY):(i+=.5*this.canvas.width,s+=.5*this.canvas.height),n.style.left=i+"px",n.style.top=s+"px",this.canvas.parentNode.appendChild(n),n.close=function(){this.parentNode&&this.parentNode.removeChild(this)},n},s.onMenuNodeCollapse=function(t,e,n,o,i){i.collapse()},s.onMenuNodePin=function(t,e,n,o,i){i.pin()},s.onMenuNodeMode=function(t,n,o,i,s){function a(t){if(s)switch(t){case"On Event":s.mode=e.ON_EVENT;break;case"On Trigger":s.mode=e.ON_TRIGGER;break;case"Never":s.mode=e.NEVER;break;case"Always":default:s.mode=e.ALWAYS;break}}return new e.ContextMenu(["Always","On Event","On Trigger","Never"],{event:o,callback:a,parentMenu:i,node:s}),!1},s.onMenuNodeColors=function(t,n,o,i,a){if(!a)throw"no node for color";var r=[];for(var l in r.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"}),s.node_colors){var u=s.node_colors[l];t={value:l,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+u.color+"; background-color:"+u.bgcolor+"'>"+l+"</span>"};r.push(t)}function p(t){if(a){var n=t.value?s.node_colors[t.value]:null;n?a.constructor===e.LGraphGroup?a.color=n.groupcolor:(a.color=n.color,a.bgcolor=n.bgcolor):(delete a.color,delete a.bgcolor),a.setDirtyCanvas(!0,!0)}}return new e.ContextMenu(r,{event:o,callback:p,parentMenu:i,node:a}),!1},s.onMenuNodeShapes=function(t,n,o,i,s){if(!s)throw"no node passed";function a(t){s&&(s.shape=t,s.setDirtyCanvas(!0))}return new e.ContextMenu(e.VALID_SHAPES,{event:o,callback:a,parentMenu:i,node:s}),!1},s.onMenuNodeRemove=function(t,e,n,o,i){if(!i)throw"no node passed";!1!==i.removable&&(i.graph.remove(i),i.setDirtyCanvas(!0,!0))},s.onMenuNodeClone=function(t,e,n,o,i){if(0!=i.clonable){var s=i.clone();s&&(s.pos=[i.pos[0]+5,i.pos[1]+5],i.graph.add(s),i.setDirtyCanvas(!0,!0))}},s.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},s.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:s.onMenuAdd},{content:"Add Group",callback:s.onGroupAdd}],this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},s.prototype.getNodeMenuOptions=function(t){var e=null;if(e=t.getMenuOptions?t.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:s.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:s.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:s.onShowMenuNodeProperties},null,{content:"Title",callback:s.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:s.onMenuNodeMode},{content:"Resize",callback:s.onResizeNode},{content:"Collapse",callback:s.onMenuNodeCollapse},{content:"Pin",callback:s.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:s.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:s.onMenuNodeShapes},null],t.onGetInputs){var n=t.onGetInputs();n&&n.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var o=t.onGetOutputs();o&&o.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var i=t.getExtraMenuOptions(this);i&&(i.push(null),e=i.concat(e))}return!1!==t.clonable&&e.push({content:"Clone",callback:s.onMenuNodeClone}),!1!==t.removable&&e.push(null,{content:"Remove",callback:s.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},s.prototype.getGroupMenuOptions=function(t){var e=[{content:"Title",callback:s.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:s.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:s.onShowPropertyEditor},null,{content:"Remove",callback:s.onMenuNodeRemove}];return e},s.prototype.processContextMenu=function(t,n){var o=this,i=s.active_canvas,a=i.getCanvasWindow(),r=null,l={event:n,callback:h,extra:t},u=null;if(t&&(u=t.getSlotInPosition(n.canvasX,n.canvasY),s.active_node=t),u)r=[],u&&u.output&&u.output.links&&u.output.links.length&&r.push({content:"Disconnect Links",slot:u}),r.push(u.locked?"Cannot remove":{content:"Remove Slot",slot:u}),r.push(u.nameLocked?"Cannot rename":{content:"Rename Slot",slot:u}),l.title=(u.input?u.input.type:u.output.type)||"*",u.input&&u.input.type==e.ACTION&&(l.title="Action"),u.output&&u.output.type==e.EVENT&&(l.title="Event");else if(t)r=this.getNodeMenuOptions(t);else{r=this.getCanvasMenuOptions();var p=this.graph.getGroupOnPos(n.canvasX,n.canvasY);p&&r.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:p,options:this.getGroupMenuOptions(p)}})}if(r)new e.ContextMenu(r,l,a);function h(e,n,i){if(e)if("Remove Slot"!=e.content)if("Disconnect Links"!=e.content){if("Rename Slot"==e.content){l=e.slot;var s=l.input?t.getInputInfo(l.slot):t.getOutputInfo(l.slot),a=o.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",n),r=a.querySelector("input");r&&s&&(r.value=s.label),a.querySelector("button").addEventListener("click",function(t){r.value&&(s&&(s.label=r.value),o.setDirty(!0)),a.close()})}}else{var l=e.slot;l.output?t.disconnectOutput(l.slot):l.input&&t.disconnectInput(l.slot)}else{var l=e.slot;l.input?t.removeInput(l.slot):l.output&&t.removeOutput(l.slot)}}},this.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.roundRect=function(t,e,n,o,i,s){void 0===i&&(i=5),void 0===s&&(s=i),this.moveTo(t+i,e),this.lineTo(t+n-i,e),this.quadraticCurveTo(t+n,e,t+n,e+i),this.lineTo(t+n,e+o-s),this.quadraticCurveTo(t+n,e+o,t+n-s,e+o),this.lineTo(t+s,e+o),this.quadraticCurveTo(t,e+o,t,e+o-s),this.lineTo(t,e+i),this.quadraticCurveTo(t,e,t+i,e)}),e.compareObjects=u,e.distance=p,e.colorToString=h,e.isInsideRectangle=c,e.growBounding=d,e.isInsideBounding=g,e.overlapBounding=f,e.hex2num=_,e.num2hex=v,y.prototype.addItem=function(t,e,n){var o=this;n=n||{};var i=document.createElement("div");i.className="litemenu-entry submenu";var s=!1;function a(t){var e=this.value;e&&e.has_submenu&&r.call(this,t)}function r(t){var e=this.value,i=!0;if(o.current_submenu&&o.current_submenu.close(t),n.callback){var s=n.callback.call(this,e,n,t,o,n.node);!0===s&&(i=!1)}if(e){if(e.callback&&!n.ignore_item_callbacks&&!0!==e.disabled){s=e.callback.call(this,e,n,t,o,n.extra);!0===s&&(i=!1)}if(e.submenu){if(!e.submenu.options)throw"ContextMenu submenu needs options";new o.constructor(e.submenu.options,{callback:e.submenu.callback,event:t,parentMenu:o,ignore_item_callbacks:e.submenu.ignore_item_callbacks,title:e.submenu.title,extra:e.submenu.extra,autoopen:n.autoopen});i=!1}}i&&!o.lock&&o.close()}return null===e?i.classList.add("separator"):(i.innerHTML=e&&e.title?e.title:t,i.value=e,e&&(e.disabled&&(s=!0,i.classList.add("disabled")),(e.submenu||e.has_submenu)&&i.classList.add("has_submenu")),"function"==typeof e?(i.dataset["value"]=t,i.onclick_callback=e):i.dataset["value"]=e,e.className&&(i.className+=" "+e.className)),this.root.appendChild(i),s||i.addEventListener("click",r),n.autoopen&&i.addEventListener("mouseenter",a),i},y.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===t?this.parentMenu.close():t&&!y.isCursorOverElement(t,this.parentMenu.root)&&y.trigger(this.parentMenu.root,"mouseleave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},y.trigger=function(t,e,n,o){var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,!0,!0,n),i.srcElement=o,t.dispatchEvent?t.dispatchEvent(i):t.__events&&t.__events.dispatchEvent(i),i},y.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},y.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},y.isCursorOverElement=function(t,e){var n=t.pageX,o=t.pageY,i=e.getBoundingClientRect();return!!i&&(o>i.top&&o<i.top+i.height&&n>i.left&&n<i.left+i.width)},e.ContextMenu=y,e.closeAllContextMenus=function(t){t=t||window;var e=t.document.querySelectorAll(".litecontextmenu");if(e.length){for(var n=[],o=0;o<e.length;o++)n.push(e[o]);for(var o in n)n[o].close?n[o].close():n[o].parentNode&&n[o].parentNode.removeChild(n[o])}},e.extendClass=function(t,e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);if(e.prototype)for(var n in e.prototype)e.prototype.hasOwnProperty(n)&&(t.prototype.hasOwnProperty(n)||(e.prototype.__lookupGetter__(n)?t.prototype.__defineGetter__(n,e.prototype.__lookupGetter__(n)):t.prototype[n]=e.prototype[n],e.prototype.__lookupSetter__(n)&&t.prototype.__defineSetter__(n,e.prototype.__lookupSetter__(n))))},e.getParameterNames=function(t){return(t+"").replace(/[\/][\/].*$/gm,"").replace(/\s+/g,"").replace(/[\/][*][^\/*]*[*][\/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},Math.clamp=function(t,e,n){return e>t?e:n<t?n:t},"undefined"==typeof window||window["requestAnimationFrame"]||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})})(this),exports.LiteGraph=this.LiteGraph,function(t){var e=t.LiteGraph;function n(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}function o(){this.size=[120,80],this.subgraph=new LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onGlobalInputAdded=this.onSubgraphNewGlobalInput.bind(this),this.subgraph.onGlobalInputRenamed=this.onSubgraphRenamedGlobalInput.bind(this),this.subgraph.onGlobalInputTypeChanged=this.onSubgraphTypeChangeGlobalInput.bind(this),this.subgraph.onGlobalOutputAdded=this.onSubgraphNewGlobalOutput.bind(this),this.subgraph.onGlobalOutputRenamed=this.onSubgraphRenamedGlobalOutput.bind(this),this.subgraph.onGlobalOutputTypeChanged=this.onSubgraphTypeChangeGlobalOutput.bind(this),this.color="#335",this.bgcolor="#557"}function i(){this.size=[120,80],this.subgraph=new LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onGlobalInputAdded=this.onSubgraphNewGlobalInput.bind(this),this.subgraph.onGlobalInputRenamed=this.onSubgraphRenamedGlobalInput.bind(this),this.subgraph.onGlobalInputTypeChanged=this.onSubgraphTypeChangeGlobalInput.bind(this),this.subgraph.onGlobalOutputAdded=this.onSubgraphNewGlobalOutput.bind(this),this.subgraph.onGlobalOutputRenamed=this.onSubgraphRenamedGlobalOutput.bind(this),this.subgraph.onGlobalOutputTypeChanged=this.onSubgraphTypeChangeGlobalOutput.bind(this),this.color="#335",this.bgcolor="#557"}function s(){var t="input",e="uri";this.addOutput(t,null),this.addOutput(e,null),this.properties={name:t,type:null,uri:e};var n=this;Object.defineProperty(this.properties,"name",{get:function(){return t},set:function(e){if(""!=e){var o=n.getOutputInfo(0);o.name!=e&&(o.name=e,n.graph&&n.graph.renameGlobalInput(t,e),t=e)}},enumerable:!0}),Object.defineProperty(this.properties,"uri",{get:function(){return e},set:function(t){if(""!=t){var o=n.getOutputInfo(1);o.name!=t&&(o.name=t,n.graph&&n.graph.renameGlobalInput(e,t),e=t)}},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return n.outputs[0].type},set:function(e){n.outputs[0].type=e,n.graph&&n.graph.changeGlobalInputType(t,n.outputs[0].type)},enumerable:!0})}function a(){var t="output",e="uri";this.addInput(t,null),this.addInput(e,null),this.addInput("withPROV-O*",null),this._value=null,this._uri=null,this.properties={name:t,type:null,uri:e};var n=this;Object.defineProperty(this.properties,"name",{get:function(){return t},set:function(e){if(""!=e){var o=n.getInputInfo(0);o.name!=e&&(o.name=e,n.graph&&n.graph.renameGlobalOutput(t,e),t=e)}},enumerable:!0}),Object.defineProperty(this.properties,"uri",{get:function(){return e},set:function(t){if(""!=t){var o=n.getInputInfo(1);o.name!=t&&(o.name=t,n.graph&&n.graph.renameGlobalOutput(e,t),e=t)}},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return n.inputs[0].type},set:function(e){n.inputs[0].type=e,n.graph&&n.graph.changeGlobalInputType(t,n.inputs[0].type)},enumerable:!0})}function r(){this.addOutput("value","number"),this.addProperty("value",1),this.editable={property:"value",type:"number"}}function l(){this.size=[60,20],this.addInput("value",0,{label:""}),this.value=0}function u(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,20]}function p(){this.mode=e.ON_EVENT,this.size=[60,20],this.addProperty("msg",""),this.addInput("log",e.EVENT),this.addInput("msg",0)}function h(){this.size=[60,20],this.addProperty("onExecute",""),this.addInput("in",""),this.addInput("in2",""),this.addOutput("out",""),this.addOutput("out2",""),this._func=null}n.title="Time",n.desc="Time",n.prototype.onExecute=function(){this.setOutputData(0,1e3*this.graph.globaltime),this.setOutputData(1,this.graph.globaltime)},e.registerNodeType("basic/time",n),o.title="Subgraph",o.desc="Graph inside a node",o.prototype.onDrawTitle=function(t){if(!this.flags.collapsed){t.fillStyle="#AAA";var n=e.NODE_TITLE_HEIGHT,o=this.size[0]-n;t.fillRect(o,-n,n,n),t.fillStyle="#333",t.beginPath(),t.moveTo(o+.2*n,.6*-n),t.lineTo(o+.8*n,.6*-n),t.lineTo(o+.5*n,.3*-n),t.fill()}},o.prototype.onDblClick=function(t,e,n){var o=this;setTimeout(function(){n.openSubgraph(o.subgraph)},10)},o.prototype.onMouseDown=function(t,n,o){if(!this.flags.collapsed&&n[0]>this.size[0]-e.NODE_TITLE_HEIGHT&&n[1]<0){var i=this;setTimeout(function(){o.openSubgraph(i.subgraph)},10)}},o.prototype.onSubgraphNewGlobalInput=function(t,e){this.addInput(t,e)},o.prototype.onSubgraphRenamedGlobalInput=function(t,e){var n=this.findInputSlot(t);if(-1!=n){var o=this.getInputInfo(n);o.name=e}},o.prototype.onSubgraphTypeChangeGlobalInput=function(t,e){var n=this.findInputSlot(t);if(-1!=n){var o=this.getInputInfo(n);o.type=e}},o.prototype.onSubgraphNewGlobalOutput=function(t,e){this.addOutput(t,e)},o.prototype.onSubgraphRenamedGlobalOutput=function(t,e){var n=this.findOutputSlot(t);if(-1!=n){var o=this.getOutputInfo(n);o.name=e}},o.prototype.onSubgraphTypeChangeGlobalOutput=function(t,e){var n=this.findOutputSlot(t);if(-1!=n){var o=this.getOutputInfo(n);o.type=e}},o.prototype.getExtraMenuOptions=function(t){var e=this;return[{content:"Open",callback:function(){t.openSubgraph(e.subgraph)}}]},o.prototype.onResize=function(t){t[1]+=20},o.prototype.onExecute=function(){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],n=this.getInputData(t);this.subgraph.setGlobalInputData(e.name,n)}if(this.subgraph.runStep(),this.outputs)for(t=0;t<this.outputs.length;t++){var o=this.outputs[t];n=this.subgraph.getGlobalOutputData(o.name);this.setOutputData(t,n)}},o.prototype.configure=function(t){LGraphNode.prototype.configure.call(this,t)},o.prototype.serialize=function(){var t=LGraphNode.prototype.serialize.call(this);return t.subgraph=this.subgraph.serialize(),t},o.prototype.clone=function(){var t=e.createNode(this.type),n=this.serialize();return delete n["id"],delete n["inputs"],delete n["outputs"],t.configure(n),t},e.registerNodeType("graph/subgraph",o),i.title="Subgraph Loop",i.desc="Graph inside a node",i.prototype.onDrawTitle=function(t){if(!this.flags.collapsed){t.fillStyle="#AAA";var n=e.NODE_TITLE_HEIGHT,o=this.size[0]-n;t.fillRect(o,-n,n,n),t.fillStyle="#333",t.beginPath(),t.moveTo(o+.2*n,.6*-n),t.lineTo(o+.8*n,.6*-n),t.lineTo(o+.5*n,.3*-n),t.fill()}},i.prototype.onDblClick=function(t,e,n){var o=this;setTimeout(function(){n.openSubgraph(o.subgraph)},10)},i.prototype.onMouseDown=function(t,n,o){if(!this.flags.collapsed&&n[0]>this.size[0]-e.NODE_TITLE_HEIGHT&&n[1]<0){var i=this;setTimeout(function(){o.openSubgraph(i.subgraph)},10)}},i.prototype.onSubgraphNewGlobalInput=function(t,e){this.addInput(t,e)},i.prototype.onSubgraphRenamedGlobalInput=function(t,e){var n=this.findInputSlot(t);if(-1!=n){var o=this.getInputInfo(n);o.name=e}},i.prototype.onSubgraphTypeChangeGlobalInput=function(t,e){var n=this.findInputSlot(t);if(-1!=n){var o=this.getInputInfo(n);o.type=e}},i.prototype.onSubgraphNewGlobalOutput=function(t,e){this.addOutput(t,e)},i.prototype.onSubgraphRenamedGlobalOutput=function(t,e){var n=this.findOutputSlot(t);if(-1!=n){var o=this.getOutputInfo(n);o.name=e}},i.prototype.onSubgraphTypeChangeGlobalOutput=function(t,e){var n=this.findOutputSlot(t);if(-1!=n){var o=this.getOutputInfo(n);o.type=e}},i.prototype.getExtraMenuOptions=function(t){var e=this;return[{content:"Open",callback:function(){t.openSubgraph(e.subgraph)}}]},i.prototype.onResize=function(t){t[1]+=20},i.prototype.onExecute=function(){if(this.outputs)for(var t=0;t<this.outputs.length;t++)this.outputs[t]=[];var e={};if(this.outputs)for(t=0;t<this.outputs.length;t++)e[t]=[];var n=this.inputs[0];for(let o of this.getInputData(0))if(this.subgraph.setGlobalInputData(n.name,o),this.subgraph.runStep(),this.outputs)for(t=0;t<this.outputs.length;t++){let n=this.outputs[t],o=this.subgraph.getGlobalOutputData(n.name);e[t].push(o)}console.log(e);for(t=0;t<this.outputs.length;t++)this.setOutputData(t,e[t])},i.prototype.configure=function(t){LGraphNode.prototype.configure.call(this,t)},i.prototype.serialize=function(){var t=LGraphNode.prototype.serialize.call(this);return t.subgraph=this.subgraph.serialize(),t},i.prototype.clone=function(){var t=e.createNode(this.type),n=this.serialize();return delete n["id"],delete n["inputs"],delete n["outputs"],t.configure(n),t},e.registerNodeType("graph/subgraphLoop",i),s.title="Input",s.desc="Input of the graph",s.prototype.onAdded=function(){this.graph.addGlobalInput(this.properties.name,this.properties.type),this.graph.addGlobalInput(this.properties.uri,"xs:string")},s.prototype.onExecute=function(){var t=this.properties.name,e=this.properties.uri,n=this.graph.global_inputs[t],o=this.graph.global_inputs[e];n&&(this.setOutputData(0,n.value),this.setOutputData(1,o.value))},e.registerNodeType("dhf/StepInput",s),a.title="Output",a.desc="Output of the graph",a.prototype.onAdded=function(){this.graph.addGlobalOutput(this.properties.name,this.properties.type),this.graph.addGlobalOutput(this.properties.uri,"xs:string")},a.prototype.getValue=function(){return this._value},a.prototype.getUri=function(){return this._uri},a.prototype.onExecute=function(){this._value=this.getInputData(0),this._uri=this.getInputData(1),this.graph.setGlobalOutputData(this.properties.name,this._value),this.graph.setGlobalOutputData(this.properties.uri,this._uri)},e.registerNodeType("dhf/StepOutput",a),r.title="Const",r.desc="Constant value",r.prototype.setValue=function(t){"string"==typeof t&&(t=parseFloat(t)),this.properties["value"]=t,this.setDirtyCanvas(!0)},r.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties["value"]))},r.prototype.onDrawBackground=function(t){this.outputs[0].label=this.properties["value"].toFixed(3)},e.registerNodeType("basic/const",r),l.title="Watch",l.desc="Show value of input",l.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},l.toString=function(t){if(null==t)return"null";if(t.constructor===Number)return t.toFixed(3);if(t.constructor===Array){for(var e="[",n=0;n<t.length;++n)e+=l.toString(t[n])+(n+1!=t.length?",":"");return e+="]",e}return String(t)},l.prototype.onDrawBackground=function(t){this.inputs[0].label=l.toString(this.value)},e.registerNodeType("basic/watch",l),u.title="Pass",u.desc="Allows to connect different types",u.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},e.registerNodeType("basic/pass",u),p.title="Console",p.desc="Show value inside the console",p.prototype.onAction=function(t,e){"log"==t?console.log(e):"warn"==t?console.warn(e):"error"==t&&console.error(e)},p.prototype.onExecute=function(){var t=this.getInputData(1);null!==t&&(this.properties.msg=t),console.log(t)},p.prototype.onGetInputs=function(){return[["log",e.ACTION],["warn",e.ACTION],["error",e.ACTION]]},e.registerNodeType("basic/console",p),h.title="Script",h.desc="executes a code",h.widgets_info={onExecute:{type:"code"}},h.prototype.onPropertyChanged=function(t,n){if("onExecute"==t&&e.allow_scripts){this._func=null;try{this._func=new Function(n)}catch(o){console.error("Error parsing script"),console.error(o)}}},h.prototype.onExecute=function(){if(this._func)try{this._func.call(this)}catch(t){console.error("Error in script"),console.error(t)}},e.registerNodeType("basic/script",h)}(this),function(global){var LiteGraph=global.LiteGraph;function GlobalEnvelopeOutput(){var t="output";this.addInput("output",null),this.addInput("headers",null),this.addInput("triples",null),this.addInput("instance",null),this.addInput("attachments",null),this._value=null,this.properties={name:t,type:null};var e=this;Object.defineProperty(this.properties,"name",{get:function(){return t},set:function(n){if(""!=n){var o=e.getInputInfo(0);o.name!=n&&(o.name=n,e.graph&&e.graph.renameGlobalOutput(t,n),t=n)}},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return e.inputs[0].type},set:function(n){e.inputs[0].type=n,e.graph&&e.graph.changeGlobalInputType(t,e.inputs[0].type)},enumerable:!0})}function StringConstant(){this.addOutput("value","xs:string"),this.addProperty("value","String Value"),this.editable={property:"value",type:"string"}}function featureLookupBlock(){this.addInput("lookupMap","xs:string"),this.addInput("value","xs:string"),this.addInput("searchKey","xs:string"),this.addInput("resultKey","xs:string"),this.addOutput("result","xs:string")}function currentDate(){this.size=[300,300],this.addOutput("current"),this.addProperty("currentDate","currentDate","enum",{values:currentDate.values})}function formatDateTimeAuto(t){}function formatDateAuto(t){}function countrySrc(){this.addOutput("name","xs:string"),this.addOutput("country","xs:string"),this.addOutput("population","xs:string"),this.addOutput("metro-population","xs:string"),this.addOutput("language","xs:string")}function lookupBlock(){this.addInput("lookupMap","uri"),this.addInput("Key1","xs:string"),this.addInput("Key2","xs:string"),this.addOutput("value")}function lookupMapsBlock(){this.addOutput("countries","uri"),this.addOutput("titles","uri"),this.addOutput("orgs","uri")}function countryBlock(){this.addInput("name","xs:string"),this.addInput("output-language","xs:string"),this.addInput("country","date"),this.addInput("population","xs:string"),this.addInput("metro-population","xs:string"),this.addInput("dense","xs:string"),this.addOutput("Object","object")}function lowercaseBlock(){this.addInput("value","xs:string"),this.addOutput("lcValue","xs:string")}function multiplyBlock(){this.addInput("value1"),this.addInput("value2"),this.addOutput("result")}function gateBlock(){this.addInput("value1"),this.addInput("value2"),this.addInput("condition"),this.addInput("trueValue"),this.addInput("falseValue"),this.addOutput("result")}function MathOperationDM(){this.addInput("A"),this.addInput("B"),this.addOutput("="),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:MathOperationDM.values})}function coalesce(t,e){return null!=t?t:null!=e?e:null}function StringConstantDM(){this.addOutput("value","xs:string"),this.addProperty("value","String Value"),this.editable={property:"value",type:"xs:string"}}function docByKey(){this.addInput("id"),this.addOutput("doc","node"),this.addProperty("Template","cts.andQuery([cts.collectionQuery('/otherCollection'),cts.jsonPropertyValueQuery('theKey',${id})])")}function stringTemplate(){this.addInput("v1"),this.addInput("v2"),this.addInput("v3"),this.addInput("v4"),this.addOutput("newString","xs:string"),this.addProperty("Template","${v1} ${v2} ${v3} ${v4}")}GlobalEnvelopeOutput.title="Output with envelope",GlobalEnvelopeOutput.desc="Output of the graph",GlobalEnvelopeOutput.prototype.onAdded=function(){this.graph.addGlobalOutput(this.properties.name,this.properties.type)},GlobalEnvelopeOutput.prototype.getValue=function(){return this._value},GlobalEnvelopeOutput.prototype.onExecute=function(){let t={envelope:{}};t.envelope.headers=void 0!=this.getInputData(1)?this.getInputData(1):{},t.envelope.triples=void 0!=this.getInputData(2)?this.getInputData(2):{},t.envelope.instance=void 0!=this.getInputData(3)?this.getInputData(3):{},t.envelope.attachments=void 0!=this.getInputData(4)?this.getInputData(4):{},this.graph.setGlobalOutputData(this.properties.name,t)},LiteGraph.registerNodeType("dhf/StepEnvelopeOutput",GlobalEnvelopeOutput),StringConstant.title="Constant",StringConstant.desc="Constant value",StringConstant.prototype.setValue=function(t){this.properties["value"]=t,this.setDirtyCanvas(!0)},StringConstant.prototype.onExecute=function(){this.setOutputData(0,this.properties["value"])},StringConstant.prototype.onDrawBackground=function(t){this.outputs[0].label=this.properties["value"]},LiteGraph.registerNodeType("string/constant",StringConstant),featureLookupBlock.title="Lookup",featureLookupBlock.prototype.onExecute=function(){let t=fn.head(cts.search(cts.andQuery([cts.collectionQuery(this.getInputData(0)),cts.jsonPropertyValueQuery(this.getInputData(2),this.getInputData(1))])));null!=t&&this.setOutputData(0,t.toObject()[this.getInputData(3)])},LiteGraph.registerNodeType("feature/lookup",featureLookupBlock),currentDate.values=["currentDate","currentDateTime","currentTime"],currentDate.title="Current date(time)",currentDate.desc="Outputs current date(time)",currentDate["currentDate"]={type:"enum",title:"currentDate",values:currentDate.values},currentDate.prototype.getTitle=function(){return this.properties.currentDate},currentDate.prototype.setValue=function(t){this.properties["value"]=t},currentDate.prototype.onExecute=function(){switch(this.properties.currentDate){case"currentDate":this.setOutputData(0,fn.currentDate());break;case"currentDateTime":this.setOutputData(0,fn.currentDateTime());break;case"currentTime":this.setOutputData(0,fn.currentTime());break}},currentDate.prototype.onDrawBackground=function(t){this.flags.collapsed},LiteGraph.registerNodeType("date/Current Date",currentDate),LiteGraph.wrapFunctionAsNode("date/formatDateTimeAuto",formatDateTimeAuto,["xs:string"],"xs:string"),LiteGraph.wrapFunctionAsNode("date/Format Date auto",formatDateAuto,["xs:string"],"xs:string"),countrySrc.title="CountrySrc",countrySrc.prototype.onExecute=function(){this.setOutputData(0,"@'name'"),this.setOutputData(1,"@'country'"),this.setOutputData(2,"@'population'"),this.setOutputData(3,"@'metro-population'"),this.setOutputData(4,"@'language'")},LiteGraph.registerNodeType("dm/CountrySrc",countrySrc),lookupBlock.title="lookup",lookupBlock.prototype.onExecute=function(){let t="lookup("+this.getInputData(0)+","+this.getInputData(1)+","+this.getInputData(2)+")";this.setOutputData(0,t)},LiteGraph.registerNodeType("dm/lookup",lookupBlock),lookupMapsBlock.title="lookupMaps",lookupMapsBlock.prototype.onExecute=function(){this.setOutputData(0,"'/countries.json'"),this.setOutputData(1,"'/titles.json'"),this.setOutputData(2,"'/orgs.json'")},LiteGraph.registerNodeType("dm/lookupMaps",lookupMapsBlock),countryBlock.title="Country",countryBlock.prototype.onExecute=function(){let t={name:"[["+this.getInputData(0)+"]]","output-language":"[["+this.getInputData(1)+"]]",country:"[["+this.getInputData(2)+"]]",population:"[["+this.getInputData(3)+"]]","metro-population":"[["+this.getInputData(4)+"]]",dense:"[["+this.getInputData(5)+"]]"};this.setOutputData(0,t)},LiteGraph.registerNodeType("dm/Country",countryBlock),lowercaseBlock.title="lowerCase",lowercaseBlock.prototype.onExecute=function(){let t=this.getInputData(0)+" => lowerCase()";this.setOutputData(0,t)},LiteGraph.registerNodeType("dm/lowerCase",lowercaseBlock),multiplyBlock.title="multiply",multiplyBlock.prototype.onExecute=function(){let t=this.getInputData(0)+" * "+this.getInputData(1);this.setOutputData(0,t)},LiteGraph.registerNodeType("dm/multiply",multiplyBlock),gateBlock.title="gate",gateBlock.prototype.onExecute=function(){let t="if("+this.getInputData(0)+" "+this.getInputData(2)+" "+this.getInputData(1)+"), "+this.getInputData(3)+","+this.getInputData(4)+")";this.setOutputData(0,t)},LiteGraph.registerNodeType("dm/gate",gateBlock),MathOperationDM.values=["+","-","*","/","%","^"],MathOperationDM.title="Operation",MathOperationDM.desc="Easy math operators",MathOperationDM["@OP"]={type:"enum",title:"operation",values:MathOperationDM.values},MathOperationDM.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},MathOperationDM.prototype.setValue=function(t){this.properties["value"]=t},MathOperationDM.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1);switch(null!=t?this.properties["A"]=t:t=this.properties["A"],null!=e?this.properties["B"]=e:e=this.properties["B"],this.properties.OP){case"+":result=t+" + "+e;break;case"-":result=t+" - "+e;break;case"x":case"X":case"*":result=t+" * "+e;break;case"/":result=t+" / "+e;break;case"%":result=t+"/"+e;break;case"^":result="Math.pow("+t+","+e+")";break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,result)},MathOperationDM.prototype.onDrawBackground=function(t){this.flags.collapsed||(t.font="40px Arial",t.fillStyle="#CCC",t.textAlign="center",t.fillText(this.properties.OP,.5*this.size[0],.35*this.size[1]+LiteGraph.NODE_TITLE_HEIGHT),t.textAlign="left")},LiteGraph.registerNodeType("dm/operation",MathOperationDM),LiteGraph.wrapFunctionAsNode("dm/coalesce",coalesce,["xs:string","xs:string"],"xs:string"),StringConstantDM.title="String Const",StringConstantDM.desc="Constant value",StringConstantDM.prototype.setValue=function(t){this.properties["value"]=t,this.setDirtyCanvas(!0)},StringConstantDM.prototype.onExecute=function(){this.setOutputData(0,"'"+this.properties["value"]+"'")},StringConstantDM.prototype.onDrawBackground=function(t){this.outputs[0].label="'"+this.properties["value"]+"'"},LiteGraph.registerNodeType("dm/constStr",StringConstantDM),docByKey.title="Get Doc by ID",docByKey.desc="Get other doc by ID",docByKey.prototype.onExecute=function(){let id=this.getInputData(0),template="`"+this.properties.Template+"`",queryStr=eval(template),query=eval(queryStr),result=fn.head(cts.search(query));this.setOutputData(0,result)},LiteGraph.registerNodeType("feature/Doc By Key",docByKey),stringTemplate.title="String Templating",stringTemplate.desc="Apply string template on inputs",stringTemplate.prototype.onExecute=function(){let v1=this.getInputData(0),v2=this.getInputData(1),v3=this.getInputData(2),v4=this.getInputData(3),template="`"+this.properties.Template+"`",result=eval(template);this.setOutputData(0,result)},LiteGraph.registerNodeType("string/Templateing",stringTemplate)}(this)}).call(this,__webpack_require__("4362"))},"7bbc":function(t,e,n){var o=n("6821"),i=n("9093").f,s={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],r=function(t){try{return i(t)}catch(e){return a.slice()}};t.exports.f=function(t){return a&&"[object Window]"==s.call(t)?r(t):i(o(t))}},"8a81":function(t,e,n){"use strict";var o=n("7726"),i=n("69a8"),s=n("9e1e"),a=n("5ca1"),r=n("2aba"),l=n("67ab").KEY,u=n("79e5"),p=n("5537"),h=n("7f20"),c=n("ca5a"),d=n("2b4c"),g=n("37c8"),f=n("3a72"),_=n("d4c0"),v=n("1169"),y=n("cb7c"),m=n("d3f4"),b=n("4bf8"),E=n("6821"),O=n("6a99"),T=n("4630"),k=n("2aeb"),w=n("7bbc"),D=n("11e9"),C=n("2621"),N=n("86cc"),I=n("0d58"),x=D.f,S=N.f,A=w.f,L=o.Symbol,M=o.JSON,G=M&&M.stringify,P="prototype",R=d("_hidden"),B=d("toPrimitive"),H={}.propertyIsEnumerable,U=p("symbol-registry"),F=p("symbols"),z=p("op-symbols"),q=Object[P],j="function"==typeof L&&!!C.f,W=o.QObject,X=!W||!W[P]||!W[P].findChild,K=s&&u(function(){return 7!=k(S({},"a",{get:function(){return S(this,"a",{value:7}).a}})).a})?function(t,e,n){var o=x(q,e);o&&delete q[e],S(t,e,n),o&&t!==q&&S(q,e,o)}:S,V=function(t){var e=F[t]=k(L[P]);return e._k=t,e},Y=j&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},$=function(t,e,n){return t===q&&$(z,e,n),y(t),e=O(e,!0),y(n),i(F,e)?(n.enumerable?(i(t,R)&&t[R][e]&&(t[R][e]=!1),n=k(n,{enumerable:T(0,!1)})):(i(t,R)||S(t,R,T(1,{})),t[R][e]=!0),K(t,e,n)):S(t,e,n)},J=function(t,e){y(t);var n,o=_(e=E(e)),i=0,s=o.length;while(s>i)$(t,n=o[i++],e[n]);return t},Q=function(t,e){return void 0===e?k(t):J(k(t),e)},Z=function(t){var e=H.call(this,t=O(t,!0));return!(this===q&&i(F,t)&&!i(z,t))&&(!(e||!i(this,t)||!i(F,t)||i(this,R)&&this[R][t])||e)},tt=function(t,e){if(t=E(t),e=O(e,!0),t!==q||!i(F,e)||i(z,e)){var n=x(t,e);return!n||!i(F,e)||i(t,R)&&t[R][e]||(n.enumerable=!0),n}},et=function(t){var e,n=A(E(t)),o=[],s=0;while(n.length>s)i(F,e=n[s++])||e==R||e==l||o.push(e);return o},nt=function(t){var e,n=t===q,o=A(n?z:E(t)),s=[],a=0;while(o.length>a)!i(F,e=o[a++])||n&&!i(q,e)||s.push(F[e]);return s};j||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=c(arguments.length>0?arguments[0]:void 0),e=function(n){this===q&&e.call(z,n),i(this,R)&&i(this[R],t)&&(this[R][t]=!1),K(this,t,T(1,n))};return s&&X&&K(q,t,{configurable:!0,set:e}),V(t)},r(L[P],"toString",function(){return this._k}),D.f=tt,N.f=$,n("9093").f=w.f=et,n("52a7").f=Z,C.f=nt,s&&!n("2d00")&&r(q,"propertyIsEnumerable",Z,!0),g.f=function(t){return V(d(t))}),a(a.G+a.W+a.F*!j,{Symbol:L});for(var ot="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;ot.length>it;)d(ot[it++]);for(var st=I(d.store),at=0;st.length>at;)f(st[at++]);a(a.S+a.F*!j,"Symbol",{for:function(t){return i(U,t+="")?U[t]:U[t]=L(t)},keyFor:function(t){if(!Y(t))throw TypeError(t+" is not a symbol!");for(var e in U)if(U[e]===t)return e},useSetter:function(){X=!0},useSimple:function(){X=!1}}),a(a.S+a.F*!j,"Object",{create:Q,defineProperty:$,defineProperties:J,getOwnPropertyDescriptor:tt,getOwnPropertyNames:et,getOwnPropertySymbols:nt});var rt=u(function(){C.f(1)});a(a.S+a.F*rt,"Object",{getOwnPropertySymbols:function(t){return C.f(b(t))}}),M&&a(a.S+a.F*(!j||u(function(){var t=L();return"[null]"!=G([t])||"{}"!=G({a:t})||"{}"!=G(Object(t))})),"JSON",{stringify:function(t){var e,n,o=[t],i=1;while(arguments.length>i)o.push(arguments[i++]);if(n=e=o[1],(m(e)||void 0!==t)&&!Y(t))return v(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Y(e))return e}),o[1]=e,G.apply(M,o)}}),L[P][B]||n("32e9")(L[P],B,L[P].valueOf),h(L,"Symbol"),h(Math,"Math",!0),h(o.JSON,"JSON",!0)},"8b24":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"flex fixed-center"},[n("mllitegraph")],1)},i=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flex flex-center"},[n("canvas",{ref:"mycanvas",staticClass:"fixed",staticStyle:{border:"1px solid"},attrs:{width:"1200",height:"800"}}),n("q-dialog",{attrs:{persistent:""},model:{value:t.editJson,callback:function(e){t.editJson=e},expression:"editJson"}},[n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[t._v("Alert")])]),n("q-card-section",[n("q-table",{attrs:{title:"Treats",data:t.currentProperties,columns:t.columns,"row-key":"name","binary-state-sort":""},scopedSlots:t._u([{key:"body",fn:function(e){return[n("q-tr",{attrs:{props:e}},[n("q-td",{key:"source",attrs:{props:e}},[t._v("\n                "+t._s(e.row.source)+"\n                "),n("q-popup-edit",{attrs:{title:"Update calories",buttons:""},model:{value:e.row.source,callback:function(n){t.$set(e.row,"source",n)},expression:"props.row.source"}},[n("q-input",{attrs:{type:"string",dense:"",autofocus:""},model:{value:e.row.source,callback:function(n){t.$set(e.row,"source",n)},expression:"props.row.source"}})],1)],1),n("q-td",{key:"target",attrs:{props:e}},[t._v("\n                "+t._s(e.row.target)+"\n                "),n("q-popup-edit",{attrs:{title:"Update calories",buttons:""},model:{value:e.row.target,callback:function(n){t.$set(e.row,"target",n)},expression:"props.row.target"}},[n("q-input",{attrs:{type:"string",dense:"",autofocus:""},model:{value:e.row.target,callback:function(n){t.$set(e.row,"target",n)},expression:"props.row.target"}})],1)],1)],1)]}}])})],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK",color:"primary"}})],1)],1)],1),n("q-dialog",{attrs:{"content-css":{minWidth:"30vw",minHeight:"40vh"}},model:{value:t.savePopUpOpened,callback:function(e){t.savePopUpOpened=e},expression:"savePopUpOpened"}},[n("q-layout",[n("q-toolbar",{attrs:{slot:"header"},slot:"header"},[n("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",round:"",dense:""}}),n("q-toolbar-title",[t._v("\n        Save current graph\n      ")])],1),n("q-toolbar",{attrs:{slot:"header"},slot:"header"}),n("q-toolbar",{attrs:{slot:"footer"},slot:"footer"},[n("q-toolbar-title")],1),n("div",{staticClass:"layout-padding"},[n("div",[n("q-input",{attrs:{"stack-label":"Graph name"},model:{value:t.graphName,callback:function(e){t.graphName=e},expression:"graphName"}})],1),n("div",{staticClass:"q-pa-sm"},[n("q-btn",{attrs:{color:"primary",label:"Save"},on:{click:function(e){return t.saveCurrentGraph()}}}),n("q-btn",{attrs:{color:"primary",label:"Close"},on:{click:function(e){t.savePopUpOpened=!1}}})],1)])],1)],1),n("q-dialog",{attrs:{"content-css":{minWidth:"30vw",minHeight:"40vh"}},model:{value:t.loadPopUpOpened,callback:function(e){t.loadPopUpOpened=e},expression:"loadPopUpOpened"}},[n("q-layout",[n("q-toolbar",{attrs:{slot:"header"},slot:"header"},[n("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",round:"",dense:""}}),n("q-toolbar-title",[t._v("\n        Save current graph\n      ")])],1),n("q-toolbar",{attrs:{slot:"footer"},slot:"footer"},[n("q-toolbar-title")],1),n("div",{staticClass:"layout-padding"},[n("q-list",{staticClass:"q-mt-md",attrs:{link:""}},[n("q-list-header",[t._v("List of saved graph")]),t._l(t.savedGraph,function(e,o){return n("q-item",{key:e.name,attrs:{tag:"label"},nativeOn:{click:function(n){return t.getSavedGraph(e.uri)}}},[n("q-item-main",[n("q-item-tile",{attrs:{label:""}},[t._v(t._s(e.name))])],1)],1)})],2),n("div",{staticClass:"q-pa-sm"},[n("q-btn",{attrs:{color:"primary",label:"Close"},on:{click:function(e){t.loadPopUpOpened=!1}}})],1)],1)],1)],1)],1)},a=[],r=n("ea1d"),l=r["a"],u=n("2877"),p=Object(u["a"])(l,s,a,!1,null,null,null),h=p.exports,c={data:function(){return{}},components:{mllitegraph:h}},d=c,g=Object(u["a"])(d,o,i,!1,null,null,null);e["default"]=g.exports},ac4d:function(t,e,n){n("3a72")("asyncIterator")},d4c0:function(t,e,n){var o=n("0d58"),i=n("2621"),s=n("52a7");t.exports=function(t){var e=o(t),n=i.f;if(n){var a,r=n(t),l=s.f,u=0;while(r.length>u)l.call(t,a=r[u++])&&e.push(a)}return e}},ea1d:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_epoilvet_dev_projects_executiongraphfront_front_quasar_RC1_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("c47a"),_Users_epoilvet_dev_projects_executiongraphfront_front_quasar_RC1_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_Users_epoilvet_dev_projects_executiongraphfront_front_quasar_RC1_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ac4d"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("8a81"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4__),litegraph_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("6e14"),litegraph_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(litegraph_js__WEBPACK_IMPORTED_MODULE_5__),file_saver__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("21a6"),file_saver__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_6__),_name$data$methods$cr;__webpack_exports__["a"]=(_name$data$methods$cr={name:"PageIndex",data:function(){return{editJson:!1,columns:[{name:"source",align:"left",label:"Source",field:"source",sortable:!0},{name:"target",label:"Target",field:"target",sortable:!0,align:"left"}],opened:!0,graph:null,results:null,models:[],jsonSource:{test:"test"},savePopUpOpened:!1,loadPopUpOpened:!1,graphName:"",savedGraph:[],currentProperties:[],jsoneditor:null}},methods:{registerModel:function(t){console.log("register model"),this.createBlock(t),this.models.push(t)},createBlock:function(t){console.log(t);var e=this.createGraphNodeFromModel(t);litegraph_js__WEBPACK_IMPORTED_MODULE_5__["LiteGraph"].registerNodeType(t.source+"/"+t.collection,e),this.models.push(t),this.$q.notify({color:"positive",position:"top",message:"The new block is now available in the library (right click)",icon:"code"})},getSavedGraph:function(t){var e=this;this.$axios.get("/v1/resources/savedGraph?rs:uri="+encodeURI(t)).then(function(t){var n=t.data,o=!0,i=!1,s=void 0;try{for(var a,r=n.models[Symbol.iterator]();!(o=(a=r.next()).done);o=!0){var l=a.value,u=e.createGraphNodeFromModel(l);litegraph_js__WEBPACK_IMPORTED_MODULE_5__["LiteGraph"].registerNodeType(l.collection,u)}}catch(p){i=!0,s=p}finally{try{o||null==r.return||r.return()}finally{if(i)throw s}}e.models=n.models,e.graph.configure(n.executionGraph)}).catch(function(){e.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})})},loadSavedGraph:function(){var t=this;this.$axios.post("/v1/resources/savedGraph").then(function(e){t.savedGraph=e.data}).catch(function(){t.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})})},createGraphNodeFromModel:function(t){var e="",n={inputs:{_count:0},outputs:{_count:0}};if(t.options.indexOf("getByUri")>-1&&(n.inputs["Uri"]=n.inputs._count++,e+='this.addInput("Uri","Uri");'),t.options.indexOf("nodeInput")>-1&&(n.inputs["Node"]=n.inputs._count++,e+='this.addInput("Node","Node");'),t.options.indexOf("nodeOutput")>-1&&(n.outputs["Node"]=n.outputs._count++,e+='this.addOutput("Node","Node");'),t.options.indexOf("fieldsOutputs")>-1){var o=!0,i=!1,s=void 0;try{for(var a,r=t.fields[Symbol.iterator]();!(o=(a=r.next()).done);o=!0){var l=a.value;n.outputs[l]=n.outputs._count++,e+='this.addOutput("'+l+'");'}}catch(m){i=!0,s=m}finally{try{o||null==r.return||r.return()}finally{if(i)throw s}}}if(t.options.indexOf("fieldsInputs")>-1){var u=!0,p=!1,h=void 0;try{for(var c,d=t.fields[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var g=c.value;n.inputs[g]=n.inputs._count++,e+='this.addInput("'+g+'");'}}catch(m){p=!0,h=m}finally{try{u||null==d.return||d.return()}finally{if(p)throw h}}}var f=new Function("{"+e+"}"),_="{let doc = {};";if(t.options.indexOf("nodeInput")&&(_+="if(this.getInputData("+n.inputs["Node"]+")!=null) {",_+="let inputNode = this.getInputData("+n.inputs["Node"]+");",_+="if(xdmp.nodeKind(inputNode)=='document') inputNode = inputNode.toObject();",_+="doc = inputNode;}"),t.options.indexOf("Uri")&&(_+="if(this.getInputData("+n.inputs["Uri"]+")!=null) doc = fn.doc(this.getInputData("+n.inputs["Uri"]+")).toObject();"),t.options.indexOf("fieldsInputs")>-1)for(var v=0;v<t.fields.length;v++)_+="doc[blockDef.fields[i]]= this.getInputData( "+n.inputs[t.fields[v]]+");";if(t.options.indexOf("fieldsOutputs")>-1){_+="let docNode = xdmp.toJSON(doc);";for(var y=0;y<t.fields.length;y++)_+="this.setOutputData( "+n.outputs[t.fields[y]]+', docNode.xpath("//'+t.fields[y]+'"));'}return _+="}",t.options.indexOf("nodeOutput")>-1&&(e+="this.setOutputData("+n.outputs["Node"]+", doc);"),console.log(_),f.prototype.onExecute=new Function(_),f.title=t.collection,f.nodeType=t.collection,f},exportDHFModule:function(){console.log("export DHF module");var t=this.graph.serialize(),e={models:null!=this.models?this.models:[],executionGraph:t},n='const DataHub = require("/data-hub/5/datahub.sjs");\nconst datahub = new DataHub();\n\n\nfunction getGraphDefinition() {\n\n  return ',o="}\n\nfunction main(content, options) {\n\n  //grab the doc id/uri\n  let id = content.uri;\n\n  //here we can grab and manipulate the context metadata attached to the document\n  let context = content.context;\n\n  //let's set our output format, so we know what we're exporting\n  let outputFormat = options.outputFormat ? options.outputFormat.toLowerCase() : datahub.flow.consts.DEFAULT_FORMAT;\n\n  //here we check to make sure we're not trying to push out a binary or text document, just xml or json\n  if (outputFormat !== datahub.flow.consts.JSON && outputFormat !== datahub.flow.consts.XML) {\n    datahub.debug.log({\n      message: 'The output format of type ' + outputFormat + ' is invalid. Valid options are ' + datahub.flow.consts.XML + ' or ' + datahub.flow.consts.JSON + '.',\n      type: 'error'\n    });\n    throw Error('The output format of type ' + outputFormat + ' is invalid. Valid options are ' + datahub.flow.consts.XML + ' or ' + datahub.flow.consts.JSON + '.');\n  }\n\n  /*\n  This scaffolding assumes we obtained the document from the database. If you are inserting information, you will\n  have to map data from the content.value appropriately and create an instance (object), headers (object), and triples\n  (array) instead of using the flowUtils functions to grab them from a document that was pulled from MarkLogic.\n  Also you do not have to check if the document exists as in the code below.\n\n  Example code for using data that was sent to MarkLogic server for the document\n  let instance = content.value;\n  let triples = [];\n  let headers = {};\n   */\n\n  //Here we check to make sure it's still there before operating on it\n  if (!fn.docAvailable(id)) {\n    datahub.debug.log({message: 'The document with the uri: ' + id + ' could not be found.', type: 'error'});\n    throw Error('The document with the uri: ' + id + ' could not be found.')\n  }\n\n  //grab the 'doc' from the content value space\n  let doc = content.value;\n\n  // let's just grab the root of the document if its a Document and not a type of Node (ObjectNode or XMLNode)\n  if (doc && (doc instanceof Document || doc instanceof XMLDocument)) {\n    doc = fn.head(doc.root);\n  }\n\n  /*\n  //get our instance, default shape of envelope is envelope/instance, else it'll return an empty object/array\n  let instance = datahub.flow.flowUtils.getInstance(doc) || {};\n\n  // get triples, return null if empty or cannot be found\n  let triples = datahub.flow.flowUtils.getTriples(doc) || [];\n\n  //gets headers, return null if cannot be found\n  let headers = datahub.flow.flowUtils.getHeaders(doc) || {};\n\n  //If you want to set attachments, uncomment here\n  // instance['$attachments'] = doc;\n  */\n\n\n\n  //insert code to manipulate the instance, triples, headers, uri, context metadata, etc.\n\n  let gHelper  = require(\"/custom-modules/graphHelper\")\n\n  instance = gHelper.executeGraphStep(doc,id,getGraphDefinition())\n\n  //form our envelope here now, specifying our output format\n // let envelope = datahub.flow.flowUtils.makeEnvelope(instance, headers, triples, outputFormat);\n\n  //assign our envelope value\n  content.value = instance.output;\n\n  //assign the uri we want, in this case the same\n  content.uri = (instance.uri!=null)?instance.uri:id;\n\n  //assign the context we want\n  content.context = context;\n\n  //now let's return out our content to be written\n  return content;\n}\n\nmodule.exports = {\n  main: main\n};\n",i=new Blob([n+JSON.stringify(e)+o],{type:"text/plain;charset=utf-8",endings:"transparent"});Object(file_saver__WEBPACK_IMPORTED_MODULE_6__["saveAs"])(i,"main.sjs")},saveCurrentGraph:function(){var t=this,e=this.graph.serialize(),n={models:null!=this.models?this.models:[],executionGraph:e,name:this.graphName};this.$axios.put("/v1/resources/savedGraph",n).then(function(e){t.$q.notify({color:"positive",position:"top",message:"Current graph is saved",icon:"code"})}).catch(function(){t.$q.notify({color:"negative",position:"top",message:"Current graph save failed",icon:"report_problem"})})},executeGraph:function(t){var e=this;console.log("executeGraph");var n=this.graph.serialize(),o={models:null!=this.models?this.models:[],executionGraph:n};this.$axios.post("/v1/resources/executeGraph",o).then(function(t){e.results=t.data,e.$root.$emit("resultReceived",e.results),e.$q.notify({color:"positive",position:"top",message:JSON.stringify(e.results),icon:"code"})}).catch(function(){e.$q.notify({color:"negative",position:"top",message:"Graph execution failed",icon:"report_problem"})})},saveGraph:function(t){this.savePopUpOpened=!0},loadGraph:function(t){this.loadSavedGraph(),this.loadPopUpOpened=!0},DblClickNode:function(t){t&&(console.log(t),null!=t.properties&&(this.currentProperties=t.properties.mapping),this.editJson=!0,console.log(this.$refs))},registerBlocksByConf:function registerBlocksByConf(LiteGraph){for(var configs=[{functionName:"fn_doc",blockName:"doc",library:"fn",inputs:[{name:"uri",type:"xs:string"}],outputs:[{name:"doc",type:"node"}],function:{ref:"fn.doc",code:null}},{functionName:"fn_collection",blockName:"collection",library:"fn",inputs:[{name:"collectionName",type:"xs:string"}],outputs:[{name:"docs",type:"node()*"}],function:{ref:"fn.collection",code:null}},{functionName:"fn_baseUri",blockName:"baseUri",library:"fn",inputs:[{name:"node",type:"node"}],outputs:[{name:"uri",type:"xs:string"}],function:{ref:"fn.baseUri",code:null}},{functionName:"fn_head",blockName:"head",library:"fn",inputs:[{name:"nodes",type:null}],outputs:[{name:"node",type:null}],function:{ref:"fn.head",code:null}},{functionName:"fn_upperCase",blockName:"UpperCase",library:"string",inputs:[{name:"string",type:"xs:string"}],outputs:[{name:"STRING",type:"xs:string"}],function:{ref:"fn.upperCase",code:null}},{functionName:"fn_lowerCase",blockName:"LowerCase",library:"string",inputs:[{name:"STRING",type:"xs:string"}],outputs:[{name:"string",type:"xs:string"}],function:{ref:"fn.lowerCase",code:null}},{functionName:"fn_count",blockName:"count",library:"fn",inputs:[{name:"list",type:null}],outputs:[{name:"nbItems",type:"number"}],function:{ref:"fn.count",code:null}},{functionName:"cts_andQuery",blockName:"andQuery",library:"cts",inputs:[{name:"query1",type:"cts:query"},{name:"query2",type:"cts:query"},{name:"query3",type:"cts:query"},{name:"query4",type:"cts:query"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:null,code:"let queries = [];    if(this.getInputData(0)!=undefined) queries.push(this.getInputData(0));    if(this.getInputData(1)!=undefined) queries.push(this.getInputData(1));    if(this.getInputData(2)!=undefined) queries.push(this.getInputData(2));    if(this.getInputData(3)!=undefined) queries.push(this.getInputData(3));    this.setOutputData( 0, cts.andQuery(queries));"}},{functionName:"cts_orQuery",blockName:"orQuery",library:"cts",inputs:[{name:"query1",type:"cts:query"},{name:"query2",type:"cts:query"},{name:"query3",type:"cts:query"},{name:"query4",type:"cts:query"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:null,code:"let queries = [];    if(this.getInputData(0)!=undefined) queries.push(this.getInputData(0));    if(this.getInputData(1)!=undefined) queries.push(this.getInputData(1));    if(this.getInputData(2)!=undefined) queries.push(this.getInputData(2));    if(this.getInputData(3)!=undefined) queries.push(this.getInputData(3));    this.setOutputData( 0, cts.orQuery(queries));"}},{functionName:"cts_search",blockName:"search",library:"cts",inputs:[{name:"query",type:"cts:query"}],outputs:[{name:"results",type:"node*"}],function:{ref:"cts.search",code:null}},{functionName:"fn_stringJoin",blockName:"String join",library:"string",inputs:[{name:"string*",type:"xs:string*"}],properties:[{name:"separator",type:"xs:string"}],outputs:[{name:"joinedString",type:"xs:string"}],function:{ref:"fn.stringJoin",code:null}},{functionName:"mapValues",blockName:"Map values",library:"string",inputs:[{name:"value",type:"xs:string"}],properties:[{name:"mapping",type:[{source:"srcVal",target:"targetVal"}]}],outputs:[{name:"mappedValue",type:"xs:string"}],function:{ref:null,code:"               let val = (this.getInputData(0)!=undefined)?this.getInputData(0):'';               let mappedValue = this.properties['mapping'].filter(item => {return item.source==val});                if(mappedValue.length >0) this.setOutputData( 0,mappedValue[0].target);                                      else  this.setOutputData( 0,null);"}},{functionName:"cts_collectionQuery",blockName:"collectionQuery",library:"cts",inputs:[{name:"collectionName",type:"xs:string"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:"cts.collectionQuery",code:null}},{functionName:"isNumber",blockName:"isNumber*",library:"controls",inputs:[{name:"value",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"isDate",blockName:"isDate*",library:"controls",inputs:[{name:"value",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"isInDictionnary",blockName:"isInDictionnary*",library:"controls",inputs:[{name:"value",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"checkRequiredFields",blockName:"checkRequiredFields*",library:"controls",inputs:[{name:"node",type:null}],outputs:[{name:"status",type:"bool"}],function:{ref:null,code:null}},{functionName:"cts_jsonPropertyValueQuery",blockName:"jsonPropertyValueQuery",library:"cts",inputs:[{name:"property",type:"xs:string"},{name:"value",type:"xs:string"}],outputs:[{name:"query",type:"cts:query"}],function:{ref:"cts.jsonPropertyValueQuery",code:null}},{functionName:"toEnvelope",blockName:"to Envelope",library:"dhf",inputs:[{name:"headers",type:"node"},{name:"triples",type:"node"},{name:"instance",type:"node"},{name:"attachments",type:"node"}],outputs:[{name:"doc",type:"node"}],function:{ref:null,code:"let result = {'envelope' : {}} ;    if(this.getInputData(0)!=undefined) result.envelope.headers = this.getInputData(0);    if(this.getInputData(1)!=undefined) result.envelope.triples = this.getInputData(1);    if(this.getInputData(2)!=undefined) result.envelope.instance = this.getInputData(2);    if(this.getInputData(3)!=undefined) result.envelope.attachments  = this.getInputData(3);    this.setOutputData( 0, result);"}},{functionName:"fromEnvelope",blockName:"from Envelope",library:"dhf",inputs:[{name:"doc",type:"node"}],outputs:[{name:"headers",type:"node"},{name:"triples",type:"node"},{name:"instance",type:"node"},{name:"attachments",type:"node"}],function:{ref:null,code:""}},{functionName:"applyXSLT",blockName:"Apply XSLT*",library:"transform",inputs:[{name:"doc",type:"node"}],outputs:[{name:"doc",type:"node"}],function:{ref:null,code:""}}],code="",_i2=0,_configs=configs;_i2<_configs.length;_i2++){var config=_configs[_i2];code+="function "+config.functionName+"(){",code+=config.inputs.map(function(t){return"this.addInput('"+t.name+(t.type?"','"+t.type+"');":"');")}).join(""),code+=config.outputs.map(function(t){return"this.addOutput('"+t.name+(t.type?"','"+t.type+"');":"');")}).join(""),code+=null!=config.properties?config.properties.map(function(t){return"this.addProperty('"+t.name+(t.type?"',"+JSON.stringify(t.type)+");":"');")}).join(""):null,code+="};",code+=config.functionName+".title = '"+config.blockName+"';",code+=config.functionName+'.prototype.onDblClick = function(e,pos,object){this.$root.$emit("nodeDblClicked",object) }.bind(this);',code+=config.functionName+".prototype.onExecute = function(){  ",null!=config.function.ref?function(){var t=0;code+="this.setOutputData( 0, "+config.function.ref+"("+config.inputs.map(function(e){return"this.getInputData("+t+++")"}).join(",")+"));"}():code+=config.function.code,code+="};",code+="LiteGraph.registerNodeType('"+config.library+"/"+config.blockName+"', "+config.functionName+" );"}eval(code)}},created:function(){},mounted:function(){console.log("mounted"),this.$root.$on("registerModel",this.registerModel),this.$root.$on("executeGraphCall",this.executeGraph),this.$root.$on("saveGraphCall",this.saveGraph),this.$root.$on("loadGraphCall",this.loadGraph),this.$root.$on("exportGraphCall",this.exportDHFModule),this.$root.$on("nodeDblClicked",this.DblClickNode),this.graph=new litegraph_js__WEBPACK_IMPORTED_MODULE_5__["LiteGraph"].LGraph,this.graph_canvas=new litegraph_js__WEBPACK_IMPORTED_MODULE_5__["LiteGraph"].LGraphCanvas(this.$refs["mycanvas"],this.graph);litegraph_js__WEBPACK_IMPORTED_MODULE_5__["LiteGraph"].createNode("basic/const");this.registerBlocksByConf(litegraph_js__WEBPACK_IMPORTED_MODULE_5__["LiteGraph"])}},_Users_epoilvet_dev_projects_executiongraphfront_front_quasar_RC1_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_name$data$methods$cr,"created",function(){this.$root.$on("blockRequested",this.createBlock)}),_Users_epoilvet_dev_projects_executiongraphfront_front_quasar_RC1_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_name$data$methods$cr,"components",{}),_name$data$methods$cr)}}]);